<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>4. Instruccions | Bases de Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-5"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Bases de Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 7: Programació en PostgreSQL</a></li>
   <li><a href="objectius_i_coneixements_previs.html" class="no-ch">Objectius i Coneixements previs</a></li>
   <li><a href="0_nota_inicial.html" class="no-ch">0. Nota inicial</a></li>
   <li><a href="1_introducci.html" class="no-ch">1. Introducció</a></li>
   <li><a href="2_plpgsql.html" class="no-ch">2. PL/pgSQL</a></li>
   <li><a href="3_declaraci_de_variables.html" class="no-ch">3. Declaració de variables</a></li>
   <li id="active"><a href="4_instruccions.html" class="active no-ch">4. Instruccions</a></li>
   <li><a href="5_funcions.html" class="daddy">5. Funcions</a>
   <ul class="other-section">
      <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
   </ul>
   </li>
   <li><a href="6_utilitzaci_de_cursors.html" class="daddy">6. Utilització de cursors</a>
   <ul class="other-section">
      <li><a href="exercicis0.html" class="no-ch">Exercicis</a></li>
   </ul>
   </li>
   <li><a href="7_missatges_i_excepcions.html" class="no-ch">7. Missatges i excepcions</a></li>
   <li><a href="8_triggers.html" class="daddy">8. Triggers</a>
   <ul class="other-section">
      <li><a href="exercicis1.html" class="no-ch">Exercicis</a></li>
   </ul>
   </li>
   <li><a href="9_creaci_daltres_objectes_basats_en_funcions.html" class="daddy">9. Creació d'altres objectes basats en funcions</a>
   <ul class="other-section">
      <li><a href="91_operadors.html" class="daddy">9.1 Operadors</a>
      <ul class="other-section">
         <li><a href="exercicis2.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li><a href="92_operadors_de_classe.html" class="no-ch">9.2 Operadors de classe</a></li>
      <li><a href="93_funcions_dagregat.html" class="daddy">9.3 Funcions d'agregat</a>
      <ul class="other-section">
         <li><a href="exercicis3.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="exercicis_de_tot_el_tema.html" class="no-ch">Exercicis de tot el tema</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="3_declaraci_de_variables.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="5_funcions.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">4. Instruccions</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id23">
<div class="iDevice emphasis0">
<div id="ta23_85" class="block iDevice_content">
<div class="nota_blau">
<p><span style="text-decoration: underline;"><strong>Nota</strong></span></p>
<p>Les instruccions que van a continuació encara no les podrem practicar, perquè han de formar part d'alguna funció. Les podrem practicar a partir de la pregunta següent</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextIdevice" id="id6">
<div class="iDevice emphasis0">
<div id="ta6_1" class="block iDevice_content">
<ul>
<li>
<p><b>Assignació</b>: es pot fer de dues maneres</p>
<ul>
<li>Directa, amb l’operador <b>:=</b> (a := 10; b := a * 0.5; )</li>
<li>Assignar el resultat d’una consulta (una única fila) a una variable o variables amb <b>INTO</b>. INTO pot anar abans o després de les columnes seleccionades:</li>
</ul>
<blockquote>
<div class="highlighted-code language-processing">
<div>
<pre><code>SELECT Max(altura) INTO a FROM POBLACIONS;</code></pre>
</div>
</div>
<div class="highlighted-code language-processing">
<div>
<pre><code>SELECT INTO a Max(altura) FROM POBLACIONS;</code></pre>
</div>
</div>
<div class="highlighted-code language-processing">
<div>
<pre><code>SELECT Max(altura),Min(altura),Avg(altura) INTO a,b,c
    FROM POBLACIONS;</code></pre>
</div>
</div>
</blockquote>
</li>
<li>
<p><b>Condicional </b></p>
<blockquote>
<div class="highlighted-code language-processing">
<div>
<pre><code>IF condició
    THEN
        Sentències;
    [ELSE
        sentències;]
END IF;</code></pre>
</div>
</div>
<p>També es pot utilitzar <b>ELSIF </b>que equival a un ELSE seguit de IF. D'aquesta manera només hi haurà un END IF al final. És la cosa més pareguda al CASE.</p>
<div class="highlighted-code language-processing">
<div>
<pre><code>IF condició1
    THEN Sentències1;
ELSIF condició2
    THEN Sentències2;
ELSE
    Sentències3;
END IF;</code></pre>
</div>
</div>
</blockquote>
</li>
<li>
<p><b>Bucles</b>: s’aconsegueixen per mig de <b>LOOP ...... END LOOP;</b></p>
<ul>
<li>
<p><b> Bucle incondicional</b></p>
<div class="highlighted-code language-processing">
<div>
<pre><code>LOOP
    Sentències
END LOOP;</code></pre>
</div>
</div>
<p>tal i com està, el bucle és infinit; per eixir <b>EXIT </b>o <b>EXIT WHEN cond</b></p>
</li>
</ul>
<br />
<ul>
<li>
<p><b> Bucle FOR</b></p>
<div class="highlighted-code language-processing">
<div>
<pre><code>FOR variable IN [REVERSE] valor_mín .. valor_màx LOOP
    Sentències
END LOOP;</code></pre>
</div>
</div>
<p>La variable comptador no s'ha de declarar i només té validesa dins del bucle.</p>
</li>
</ul>
<br />
<ul>
<li>
<p><b> Bucle WHILE</b></p>
<div class="highlighted-code language-processing">
<div>
<pre><code>WHILE condició LOOP
    Sentències
END LOOP;</code></pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><b> Sentències SQL</b>: es poden executar sense problema totes aquelles sentències que no tornen cap resultat (INSERT, UPDATE, DELETE, CREATE TABLE, ...). La sentència SELECT, que sí que torna un valor s'ha d'utilitzar amb la clàusula INTO (com ja hem vist), o dins de PERFORM (com ara veurem).</p>
</li>
</ul>
<p></p>
<ul>
<li>
<p><b> Execució d'altres funcions</b>. En moltes ocasions ens farà falta executar una altra funció. Si aquesta torna un valor la posarem dins d'una sentència (assignació, en una condició, ...). Però i si no torna cap valor? El mateix podríem dir d'una sentència SELECT (encara que la utilitat d'açò és més dubtosa). Ho farem per mig de PERFORM, que executa una sentència, ignorant el possible valor tornat per aquesta.</p>
<p>Per exemple (recordeu que <b>loc_pobl,</b> la funció creada en la pregunta anterior, no torna cap valor, sinó que ho trau per pantalla):</p>
<div class="highlighted-code language-processing">
<div>
<pre><code>PERFORM loc_pobl('Aín');</code></pre>
</div>
</div>
<div class="highlighted-code language-processing">
<div>
<pre><code>PERFORM (SELECT * FROM POBLACIONS);</code></pre>
</div>
</div>
</li>
<li>
<p><b> Execució en forma dinàmica</b>. Hi haurà ocasions en que la sentència SQL la voldrem construir en temps d'execució, és a dir de forma dinàmica. Això ens ho permet <b>EXECUTE</b>, que el que fa es passar la cadena de caràcters que va a continuació al motor SQL.</p>
<p>Per exemple:</p>
<div class="highlighted-code language-processing">
<div>
<pre><code>EXECUTE 'SELECT ' || $2 || ' FROM ' || $1;</code></pre>
</div>
</div>
<p>De moment no fa res, perquè el resultat de la sentència es perd, però ja veurem més avant la seua aplicació. Un altre exemple, on esborraríem les files d'una taula on un camp coincideix amb un valor (tot passat com a paràmetres):</p>
<div class="highlighted-code language-processing">
<div>
<pre><code>EXECUTE 'DELETE FROM ' || $1 || ' WHERE ' || $2 || ' = ' || $3;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="3_declaraci_de_variables.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="5_funcions.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Llicència Creative Commons Reconeixement NoComercial CompartirIgual 3.0</a></p>
</div>
</div>
</div>
</div>
</body></html>