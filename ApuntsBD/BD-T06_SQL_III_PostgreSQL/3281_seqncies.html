<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>3.2.8.1 Seqüències | Bases de Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/3.0/" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-76"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Bases de Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 6: SQL -  DDL i consultes d'actualització (part III)</a></li>
   <li><a href="31_introducci.html" class="no-ch">3.1 Introducció</a></li>
   <li class="current-page-parent"><a href="32_ddl.html" class="current-page-parent daddy">3.2 DDL</a>
   <ul>
      <li><a href="321_tipus_de_dades.html" class="no-ch">3.2.1 Tipus de dades</a></li>
      <li><a href="322_create_table.html" class="daddy">3.2.2 CREATE TABLE</a>
      <ul class="other-section">
         <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li><a href="323_restriccions_constraint.html" class="daddy">3.2.3 Restriccions (Constraint)</a>
      <ul class="other-section">
         <li><a href="exercicis0.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li><a href="324_alter_table.html" class="daddy">3.2.4 ALTER TABLE</a>
      <ul class="other-section">
         <li><a href="exercicis1.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li><a href="325_drop_table.html" class="no-ch">3.2.5 DROP TABLE</a></li>
      <li><a href="326_ndex.html" class="daddy">3.2.6 Índex</a>
      <ul class="other-section">
         <li><a href="exercicis2.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li><a href="327_vistes.html" class="daddy">3.2.7 Vistes</a>
      <ul class="other-section">
         <li><a href="exercicis3.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li class="current-page-parent"><a href="328_creaci_daltres_objectes_seqncies_dominis_i_tipus.html" class="current-page-parent daddy">3.2.8. Creació d'altres objectes: seqüències, dominis i tipus.</a>
      <ul>
         <li id="active"><a href="3281_seqncies.html" class="active no-ch">3.2.8.1 Seqüències</a></li>
         <li><a href="3282_dominis.html" class="no-ch">3.2.8.2 Dominis</a></li>
         <li><a href="3283_tipus_de_dades.html" class="no-ch">3.2.8.3 Tipus de dades</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="33_consultes_dactualitzaci.html" class="daddy">3.3 Consultes d'actualització</a>
   <ul class="other-section">
      <li><a href="331_insert.html" class="daddy">3.3.1 INSERT</a>
      <ul class="other-section">
         <li><a href="exercicis4.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li><a href="332_delete.html" class="daddy">3.3.2 DELETE</a>
      <ul class="other-section">
         <li><a href="exercicis5.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
      <li><a href="333_update.html" class="daddy">3.3.3 UPDATE</a>
      <ul class="other-section">
         <li><a href="exercicis6.html" class="no-ch">Exercicis</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="exercicis_de_tot_el_tema.html" class="no-ch">Exercicis de tot el tema</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="328_creaci_daltres_objectes_seqncies_dominis_i_tipus.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="3282_dominis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">3.2.8.1 Seqüències</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id66">
<div class="iDevice emphasis0">
<div id="ta66_1" class="block iDevice_content">
<p> </p>
<p>També es poden crear seqüències (<b>SEQUENCE)</b>, que són objectes que agafen valors numèrics que van incrementant-se (com l'autonumèric).</p>
<p class="codiSQL">CREATE SEQUENCE <i>nom_seqüència</i> <br /> [START WITH <i>valor_inicial</i>] <br /> [INCREMENTED BY <i>valor_increment</i>] ... ;</p>
<p>La sentència és més llarga, per a considerar més casos. Per a nosaltres està bé així.</p>
<p>Per defecte, el valor inicial és 1, i l'increment també 1.</p>
<p>És un objecte independent de les taules. S'utilitza de la següent manera:</p>
<blockquote>
<p><b>CURRVAL ('</b><b><i>nom_seqüència</i>') </b>torna el valor actual (ha d'estar inicialitzat)</p>
</blockquote>
<blockquote>
<p><b>NEXTVAL('</b><b><i>nom_seqüència</i>') </b>incrementa la seqüència i torna el nou valor (excepte la primera vegada que l'inicia amb el valor inicial)</p>
</blockquote>
<p>La manera habitual d'utilitzar-lo serà per obtenir un valor que s'afegirà a un camp d'una taula (normalment la clau principal).</p>
<p>Suposem que tenim una taula anomenada <strong>FACTURA</strong> amb l'estructura que ve a continuació, i volem que la clau principal siga un autonumèric. Ho podem provar sobre la Base de Dades i usuari <strong>proves</strong>.</p>
<div class="codiSQL">CREATE TABLE FACTURA<br /> ( num_f NUMERIC(7) CONSTRAINT cp_fact PRIMARY KEY,<br /> data DATE,<br /> client VARCHAR(10));</div>
<p>Primer ens crearem la seqüència:</p>
<p class="codiSQL">CREATE SEQUENCE s_num_fac START WITH 2016001;</p>
<p>Després l'utilitzem:</p>
<p class="codiSQL">INSERT INTO FACTURA VALUES (NEXTVAL('s_num_fac'), '15-01-2016','cli001');</p>
<p>Si ara mirem el contingut de la taula <strong>FACTURA</strong> obtindrem:</p>
<p style="text-align: center;"><img src="T6_III_2_8_1_1.png" style="border: 1px solid black;" /></p>
<p>O fins i tot en el moment de declarar la taula, li posem un valor per defecte al camp, que serà el següent de la seqüència. No haurem d'introduir ara res en la columna <strong>num_f</strong>,  que agafa el valor de la seqüència</p>
<p class="codiSQL">CREATE TABLE FACTURA2<br /> ( num_f NUMERIC(7) CONSTRAINT cp_fact2 PRIMARY KEY DEFAULT NEXTVAL('s_num_fac'),<br /> data DATE,<br /> client VARCHAR(10));</p>
<p class="codiSQL">INSERT INTO FACTURA2(data,client) VALUES ('15-01-2016','cli001');</p>
<p style="text-align: center;">Observeu també que en la taula <span style="font-weight: bold;">FACTURA2</span>, el valor comença per <strong>2016002</strong>, ja que el primer valor l'havíem utilitzat en <span style="font-weight: bold;">FACTURA</span>. Per tant el contingut de la taula <strong>FACTURA2</strong> serà:<img src="T6_III_2_8_1_2.png" style="border: 1px solid black;" height="92" width="297" /></p>
<p></p>
<p>També ho podríem haver fet declarant la clau de tipus <b>SERIAL</b>, que el que fa és implementar una seqüència, i donar valors successius per al camp on està definida. Però d'aquesta manera la seqüència comença sempre per 1</p>
<p class="codiSQL">CREATE TABLE FACTURA3<br /> ( num_f SERIAL CONSTRAINT cp_fact3 PRIMARY KEY,<br /> data DATE,<br /> client VARCHAR(10));</p>
<p>I després fer la inserció d'aquesta manera:</p>
<p class="codiSQL">INSERT INTO FACTURA3(data,client) VALUES ('15-01-2016','cli001')</p>
<p>Com comentàvem, el valor introduït per la seqüència serà <strong>1</strong>:</p>
<p style="text-align: center;"><img src="T6_III_2_8_1_3.png" style="border: 1px solid black;" height="93" width="316" /></p>
<p>Tornarem a veure aquest exemple en les consultes d'actualització, concretament el <strong>INSERT</strong>.</p>
<p></p>
<p>Per a esborrar una seqüència utilitzarem la sentència <strong>DROP SEQUENCE</strong>:</p>
<p class="codiSQL">DROP SEQUENCE s_num_fac</p>
<p>De moment aquesta sentència ens donaria error, ja que la taula <strong>FACTURA2</strong> utilitza aquesta seqüència. Esborrarem primer les 3 taules, i després la seqüència per a no interferir amb els companys/es.</p>
<p class="codiSQL">DROP TABLE FACTURA, FACTURA2, FACTURA3;</p>
<p class="codiSQL">DROP SEQUENCE s_num_fac;</p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="328_creaci_daltres_objectes_seqncies_dominis_i_tipus.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="3282_dominis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Llicència Creative Commons Reconeixement NoComercial CompartirIgual 3.0</a></p>
</div>
</div>
</div>
</div>
</body></html>