<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>7.1.5 - Modificar la Base de Dades | Accés a Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/2.5/" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-58"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Accés a Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 9: Bases de Dades XML</a></li>
   <li><a href="1__introducci.html" class="no-ch">1 - Introducció</a></li>
   <li><a href="2__estratgies_demmagatzematge_de_xml.html" class="no-ch">2 - Estratègies d'emmagatzematge de XML</a></li>
   <li><a href="3__emmagatzematge_en_sgbd_tradicionals.html" class="daddy">3 - Emmagatzematge en SGBD tradicionals</a>
   <ul class="other-section">
      <li><a href="31__tipus_de_dades_xml.html" class="no-ch">3.1 - Tipus de dades XML</a></li>
      <li><a href="32__funcions_de_conversi.html" class="no-ch">3.2 - Funcions de conversió</a></li>
      <li><a href="33__funcions_que_produeixen_contingut_xml.html" class="no-ch">3.3 - Funcions que produeixen contingut XML</a></li>
      <li><a href="34__convertir_taules_senceres_a_xml.html" class="no-ch">3.4 - Convertir taules senceres a XML</a></li>
      <li><a href="35__consultes_xpath.html" class="no-ch">3.5 - Consultes XPATH</a></li>
      <li><a href="36__utilitzaci_des_de_java.html" class="no-ch">3.6 - Utilització des de Java</a></li>
      <li><a href="37__ampliaci.html" class="no-ch">3.7 - Ampliació</a></li>
   </ul>
   </li>
   <li><a href="4__emmagatzematge_en_bdxml_natives.html" class="no-ch">4 - Emmagatzematge en BD-XML Natives</a></li>
   <li><a href="5__installaci_de_bdxml_natives.html" class="no-ch">5 - Instal·lació de BD-XML Natives</a></li>
   <li><a href="6__llenguatges_de_consultes_xpath_i_xquery.html" class="daddy">6 - Llenguatges de consultes XPATH i XQUERY</a>
   <ul class="other-section">
      <li><a href="61__xpath.html" class="daddy">6.1 - XPATH</a>
      <ul class="other-section">
         <li><a href="611__vista_darbre.html" class="no-ch">6.1.1 - Vista d'arbre</a></li>
         <li><a href="612__navegaci.html" class="no-ch">6.1.2 - Navegació</a></li>
         <li><a href="613__seqncies.html" class="no-ch">6.1.3 - Seqüències</a></li>
         <li><a href="614__funcions.html" class="no-ch">6.1.4 - Funcions</a></li>
      </ul>
      </li>
      <li><a href="62__xquery.html" class="daddy">6.2 - XQUERY</a>
      <ul class="other-section">
         <li><a href="621__consultes_xquery.html" class="no-ch">6.2.1 - Consultes XQuery</a></li>
         <li><a href="622__variables.html" class="no-ch">6.2.2 - Variables</a></li>
         <li><a href="623__expressions_avaluables.html" class="no-ch">6.2.3 - Expressions avaluables</a></li>
         <li><a href="624__expressions_flwor.html" class="no-ch">6.2.4 - Expressions FLWOR</a></li>
         <li><a href="625__alternatives.html" class="no-ch">6.2.5 - Alternatives</a></li>
         <li><a href="626__exemple_de_consulta_elaborada.html" class="no-ch">6.2.6 - Exemple de consulta "elaborada"</a></li>
         <li><a href="627__funcions_de_existdb_de_manipulaci_de_bd.html" class="no-ch">6.2.7 - Funcions de eXist-db de manipulació de BD</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="7__api_java_estndards_per_a_bdxml_natives.html" class="current-page-parent daddy">7 - API Java estàndards per a BD-XML natives</a>
   <ul>
      <li class="current-page-parent"><a href="71__api_xqj.html" class="current-page-parent daddy">7.1 - API XQJ</a>
      <ul>
         <li><a href="711__descrrega.html" class="no-ch">7.1.1 - Descàrrega</a></li>
         <li><a href="712__connexi.html" class="no-ch">7.1.2 - Connexió</a></li>
         <li><a href="713__resultats_de_sentncies_xquery.html" class="no-ch">7.1.3 - Resultats de sentències XQuery</a></li>
         <li><a href="714__processar_el_resultat.html" class="no-ch">7.1.4 - Processar el resultat</a></li>
         <li id="active"><a href="715__modificar_la_base_de_dades.html" class="active no-ch">7.1.5 - Modificar la Base de Dades</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="714__processar_el_resultat.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">7.1.5 - Modificar la Base de Dades</h1></div>
<div class="iDevice_wrapper textIdevice" id="id86">
<div class="iDevice emphasis0" >
<div id="ta86_110_2" class="block iDevice_content">

</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id87">
<div class="iDevice emphasis0" >
<div id="ta87_111_2" class="block iDevice_content">
<div class="exe-text"><p>Per a poder guardar documents en la Base de Dades ens aprofitarem de les funcions vistes en la pregunta 6.2.7. Per mig d'elles podíem modificar la Base de Dades utilitzant aquestes funcions dins una sentència XQuery: crear col·leccions, guardar documents, ...</p>
<p>Per tant, serà tan senzill com executar una sentència XQuery. La única dificultat serà jugar amb les cometes: en la sentència XQuery li hauran d'arribar a <strong>eXist-db</strong> alguns paràmetres amb cometes (simples o dobles).</p>
<p>Com que anem a modificar la Base de Dades, ara sí que ens haurem d'autenticar.</p>
<p>Mirem primer un programeta per a crear un document extremadament senzill, amb un únic element buit. Poseu-li el nom de <strong>Prova9_XQJ_GuardarDocument_1.kt</strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>import net.xqj.exist.ExistXQDataSource

fun main() {
	val s = ExistXQDataSource()
	s.setProperty("serverName", "localhost")
	s.setProperty("port", "8080")
	s.setProperty("user", "admin")
	s.setProperty("password", "admin")
	val conn = s.getConnection()
	val exp = conn.createExpression()
	exp.executeCommand("xmldb:store(\"Tema9\", \"FitxerKotlin.xml\", \"&lt;Hola/&gt;\")")
	conn.close()
}</code></pre>
</div>
</div>
<p>Observeu, com en aquest exemple hem escapat les cometes dobles, per a que arriben a <strong>eXist-db</strong>. Si refresquem el directori en <strong>eXide</strong>, veurem que ja apareix el document nou, i podrem veure el seu contingut</p>
<p><img src="T9_7_1_5_1.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" width="710" height="264" /></p>
<p>Mirem un altre exemple, en el qual guardarem un altre document, més elaborat. És el mateix document que el que vam guardar en un fitxer en l'exemple <strong>Prova7_XQJ.kt</strong>, però ara guardant-lo en la Base de Dades.</p>
<p>Primer veurem una implementació en la qual ens baixem el resultat de la sentència de la qual volem guardar el resultat. Observeu com juguem amb les cometes simples i dobles, per no haver d'escapar les cometes dobles. Es mostra el resultat de la sentència de guardar el document, per veure que és correcta. Guardeu el programa amb el nom <strong>Prova9_XQJ_GuadarDocument_2.kt</strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>import net.xqj.exist.ExistXQDataSource
import java.io.File
import java.io.IOException
import java.util.Properties

fun main() {
	//val f = File("notes.xml")
	val s = ExistXQDataSource()
	s.setProperty("serverName", "89.36.214.106")
	s.setProperty("port", "8080")
	s.setProperty("user", "admin")
	s.setProperty("password", "ieselcaminas.ad")


	val conn = s.getConnection()
	val sent = "for \$classe in /classe " +
				"return &lt;notes&gt;&lt;modul nom=\"{\$classe/assignatura/text()}\"&gt;" +
								"{for \$alumne in \$classe//alumne " +
								"order by \$alumne/cognoms " +
								"return &lt;alumne nota=\"{\$alumne/nota/text()}\"&gt;" +
									"{concat(\$alumne/nom/text(), \" \", \$alumne/cognoms)}" +
									"&lt;/alumne&gt;}&lt;/modul&gt;&lt;/notes&gt; ";

	val cons = conn.prepareExpression (sent)

	val rs = cons.executeQuery ()
	var text ="&lt;?xml version=\"1.0\" ?&gt;\n"
	while (rs.next()) {
		text += rs.getItemAsString (null)
		}
	val col = "Tema9"
	val doc = "classe_Kotlin.xml"
	val com = "xmldb:store('$col', '$doc', '$text')"
	println(com)
	conn.createExpression().executeCommand(com)
	conn.close()
}</code></pre>
</div>
</div>
<p>Evidentment ho podíem fer més curt, ja que en el programa no manipulem el resultat de la sentència XQuery. Aquesta és una segona versió del mateix programa, que queda més curta. Guardeu-lo amb el nom <strong>Prova10_XQJ_GuardarDocument_3.kt</strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>import net.xqj.exist.ExistXQDataSource

fun main() {
	//val f = File("notes.xml")
	val s = ExistXQDataSource()
	s.setProperty("serverName", "89.36.214.106")
	s.setProperty("port", "8080")
	s.setProperty("user", "admin")
	s.setProperty("password", "ieselcaminas.ad")


	val conn = s.getConnection()
	val sent = "for \$classe in /classe " +
				"return &lt;notes&gt;&lt;modul nom=\"{\$classe/assignatura/text()}\"&gt;" +
								"{for \$alumne in \$classe//alumne " +
								"order by \$alumne/cognoms " +
								"return &lt;alumne nota=\"{\$alumne/nota/text()}\"&gt;" +
									"{concat(\$alumne/nom/text(), \" \", \$alumne/cognoms)}" +
									"&lt;/alumne&gt;}&lt;/modul&gt;&lt;/notes&gt; "

	val col = "Tema9"
	val doc = "classe_Kotlin_2.xml"
	val com = "xmldb:store('$col', '$doc', $sent)"
	println(com)
	conn.createExpression().executeCommand(com)
	conn.close()
}</code></pre>
</div>
</div>
<p>I aquest seria el resultat:</p>
<p style="text-align: center;"><img src="T9_7_1_5_2.png" alt="" width="715" height="256" /></p>
<div class="nota_blau">
<p><b><u>Nota</u></b></p>
<p>Aquestos exemples no es podrien fer connectant amb el servidor de l'Institut.</p>
<p>Si heu tingut problemes amb la instal·lació de <strong>eXist-db</strong>, no cal que feu aquestos exemples</p>
</div></div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="714__processar_el_resultat.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial CompartirIgual 2.5</a></p>
</div>
</div>
</div>
</div>
</body></html>