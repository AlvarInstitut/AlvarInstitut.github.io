<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>6.2.1 - Consultes XQuery | Accés a Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/2.5/" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-44"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Accés a Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 9: Bases de Dades XML</a></li>
   <li><a href="1__introducci.html" class="no-ch">1 - Introducció</a></li>
   <li><a href="2__estratgies_demmagatzematge_de_xml.html" class="no-ch">2 - Estratègies d'emmagatzematge de XML</a></li>
   <li><a href="3__emmagatzematge_en_sgbd_tradicionals.html" class="daddy">3 - Emmagatzematge en SGBD tradicionals</a>
   <ul class="other-section">
      <li><a href="31__tipus_de_dades_xml.html" class="no-ch">3.1 - Tipus de dades XML</a></li>
      <li><a href="32__funcions_de_conversi.html" class="no-ch">3.2 - Funcions de conversió</a></li>
      <li><a href="33__funcions_que_produeixen_contingut_xml.html" class="no-ch">3.3 - Funcions que produeixen contingut XML</a></li>
      <li><a href="34__convertir_taules_senceres_a_xml.html" class="no-ch">3.4 - Convertir taules senceres a XML</a></li>
      <li><a href="35__consultes_xpath.html" class="no-ch">3.5 - Consultes XPATH</a></li>
      <li><a href="36__utilitzaci_des_de_java.html" class="no-ch">3.6 - Utilització des de Java</a></li>
      <li><a href="37__ampliaci.html" class="no-ch">3.7 - Ampliació</a></li>
   </ul>
   </li>
   <li><a href="4__emmagatzematge_en_bdxml_natives.html" class="no-ch">4 - Emmagatzematge en BD-XML Natives</a></li>
   <li><a href="5__installaci_de_bdxml.html" class="no-ch">5 - Instal·lació de BD-XML</a></li>
   <li class="current-page-parent"><a href="6__llenguatges_de_consultes_xpath_i_xquery.html" class="current-page-parent daddy">6 - Llenguatges de consultes XPATH i XQUERY</a>
   <ul>
      <li><a href="61__xpath.html" class="daddy">6.1 - XPATH</a>
      <ul class="other-section">
         <li><a href="611__vista_darbre.html" class="no-ch">6.1.1 - Vista d'arbre</a></li>
         <li><a href="612__navegaci.html" class="no-ch">6.1.2 - Navegació</a></li>
         <li><a href="613__seqncies.html" class="no-ch">6.1.3 - Seqüències</a></li>
         <li><a href="614__funcions.html" class="no-ch">6.1.4 - Funcions</a></li>
      </ul>
      </li>
      <li class="current-page-parent"><a href="62__xquery.html" class="current-page-parent daddy">6.2 - XQUERY</a>
      <ul>
         <li id="active"><a href="621__consultes_xquery.html" class="active no-ch">6.2.1 - Consultes XQuery</a></li>
         <li><a href="622__variables.html" class="no-ch">6.2.2 - Variables</a></li>
         <li><a href="623__expressions_avaluables.html" class="no-ch">6.2.3 - Expressions avaluables</a></li>
         <li><a href="624__expressions_flwor.html" class="no-ch">6.2.4 - Expressions FLWOR</a></li>
         <li><a href="625__alternatives.html" class="no-ch">6.2.5 - Alternatives</a></li>
         <li><a href="626__exemple_de_consulta_elaborada.html" class="no-ch">6.2.6 - Exemple de consulta "elaborada"</a></li>
         <li><a href="627__funcions_de_existdb_de_manipulaci_de_bd.html" class="no-ch">6.2.7 - Funcions de eXist-db de manipulació de BD</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="7__api_java_estndards_per_a_bdxml_natives.html" class="daddy">7 - API Java estàndards per a BD-XML natives</a>
   <ul class="other-section">
      <li><a href="71__api_xqj.html" class="daddy">7.1 - API XQJ</a>
      <ul class="other-section">
         <li><a href="711__descrrega.html" class="no-ch">7.1.1 - Descàrrega</a></li>
         <li><a href="712__connexi.html" class="no-ch">7.1.2 - Connexió</a></li>
         <li><a href="713__resultats_de_sentncies_xquery.html" class="no-ch">7.1.3 - Resultats de sentències XQuery</a></li>
         <li><a href="714__processar_el_resultat.html" class="no-ch">7.1.4 - Processar el resultat</a></li>
         <li><a href="715__modificar_la_base_de_dades.html" class="no-ch">7.1.5 - Modificar la Base de Dades</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="62__xquery.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="622__variables.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">6.2.1 - Consultes XQuery</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id51">
<div class="iDevice emphasis0">
<div id="ta51_1" class="block iDevice_content">
<p>Generalment una consulta XQuery consistirà en aconseguir les dades amb les quals es vol treballar, filtrar-les i retornar el resultat com a XML. L’expressió més simple que es pot fer en XQuery és escriure un element buit:</p>
<p class="codi">&lt;Hola /&gt;</p>
<p>En executar aquesta ordre el resultat serà:</p>
<div class="codi2">
<div>&lt;?xml version="1.0" ?&gt;</div>
<div>&lt;Hola/&gt;</div>
</div>
<p>Encara que a nosaltres en l'entorn de <strong>eXist</strong> ens eixirà únicament l'etiqueta. A pesar d'això serà un document ben format.</p>
<p>Aquesta és una de les característiques importants de XQuery. Pot escriure literalment un text. Però si en el resultat es defineixen etiquetes, l’expressió només serà correcta si el resultat final està ben format. Per exemple, executar el següent en XQuery donarà un error, ja que el resultat final no està ben format:</p>
<div class="codi">
<div><span style="color: #ff0000;">&lt;a&gt;</span></div>
</div>
<p class="codi2"><span style="color: #ff0000;">Cannot compile xquery: exerr:ERROR err:XPST0003: No closing end tag found for element constructor: a [at line 2, column 2]</span></p>
<p>(observeu com en l'error ens avisa que no ha trobat el tancament de l'etiqueta, és a dir, que falta <strong>&lt;/a&gt;</strong>)</p>
<p>Però a pesar de poder escriure text, el més corrent és recuperar algun tipus de dades, avaluar-les i retornar el resultat amb un <b>return</b>, que és la instrucció que s’encarrega de generar les sortides.</p>
<p>Una altra característica important és que <strong>fa servir variables</strong>. Per exemple la següent és una expressió XQuery correcta que assigna el valor 5 a <strong><b>$a</b></strong> i després en retorna el valor:  </p>
<div class="codi">
<div>let $a:=5</div>
<div>return $a</div>
</div>
<p>El resultat d’executar-ho amb XQuery serà:</p>
<div class="codi2">
<div>5</div>
</div>
<p>A diferència del que passa amb els literals, el <strong>return</strong> s’executa una vegada per cada valor que agafa del <strong>for</strong>, de manera que si hi ha una expressió que es fa més d’una vegada:</p>
<div class="codi">
<div>for $a in (1,2)</div>
<div>return &lt;Hola/&gt;</div>
</div>
<p>El return s'executaria més d'una vegada:</p>
<div class="codi2">
<div>&lt;Hola/&gt;</div>
<div><span>&lt;Hola/&gt;</span></div>
</div>
<p> </p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="62__xquery.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="622__variables.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial CompartirIgual 2.5</a></p>
</div>
</div>
</div>
</div>
</body></html>