<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>5.3.4 CS-Android: Exemple ampliat, combinant amb Cloud Firestore | Bases de Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-nd/4.0/" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-80"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Bases de Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 7: FIREBASE</a></li>
   <li><a href="1__introducci_firebase.html" class="no-ch">1 - Introducció: Firebase</a></li>
   <li><a href="2__creaci_duna_aplicaci.html" class="no-ch">2 - Creació d'una aplicació</a></li>
   <li><a href="3__realtime_database_rd.html" class="daddy">3 - Realtime Database (RD)</a>
   <ul class="other-section">
      <li><a href="31_rd_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">3.1 RD: Utilització des de l'entorn de Firebase</a></li>
      <li><a href="32_rd_utilitzaci_des_de_intellij.html" class="daddy">3.2 RD: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="321_rdintellij_connexi_des_de_kotlin.html" class="no-ch">3.2.1 RD-IntelliJ: Connexió des de Kotlin</a></li>
         <li><a href="322_rdintellij_accs_a_les_dades.html" class="no-ch">3.2.2 RD-IntelliJ: Accés a les dades</a></li>
         <li><a href="323_rdintellij_tot_lexemple.html" class="no-ch">3.2.3 RD-IntelliJ: Tot l'exemple</a></li>
      </ul>
      </li>
      <li><a href="33_rd_utilitzaci_des_dandroid.html" class="daddy">3.3 RD: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="331_rdandroid_connexi_des_dandroid.html" class="no-ch">3.3.1 RD-Android: Connexió des d'Android</a></li>
         <li><a href="332_rdandroid_accs_a_les_dades.html" class="no-ch">3.3.2 RD-Android: Accés a les dades</a></li>
         <li><a href="333_rdandroid_tot_lexemple.html" class="no-ch">3.3.3 RD-Android: Tot l'exemple</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="4__cloud_firestore_cf.html" class="daddy">4 - Cloud Firestore (CF)</a>
   <ul class="other-section">
      <li><a href="41_cf_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">4.1 CF: Utilització des de l'entorn de Firebase</a></li>
      <li><a href="42_cf_utilitzaci_des_de_intellij.html" class="daddy">4.2 CF: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="421_cfintellij_connexi_des_de_kotlin.html" class="no-ch">4.2.1 CF-IntelliJ: Connexió des de Kotlin</a></li>
         <li><a href="422_cfintellij_accs_a_les_dades.html" class="no-ch">4.2.2 CF-IntelliJ: Accés a les dades</a></li>
         <li><a href="423_cfintellij_tot_lexemple.html" class="no-ch">4.2.3 CF-IntelliJ: Tot l'exemple</a></li>
         <li><a href="424_cfintellij_exemple_ampliat.html" class="no-ch">4.2.4 CF-IntelliJ: Exemple ampliat</a></li>
      </ul>
      </li>
      <li><a href="43_cf_utilitzaci_des_dandroid.html" class="daddy">4.3 CF: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="431_cfandroid_connexi.html" class="no-ch">4.3.1 CF-Android: Connexió</a></li>
         <li><a href="432_cfandroid_accs_a_les_dades.html" class="no-ch">4.3.2 CF-Android: Accés a les dades</a></li>
         <li><a href="433_cfandroid_tot_lexemple.html" class="no-ch">4.3.3 CF-Android: Tot l'exemple</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="5__cloud_storage.html" class="current-page-parent daddy">5 - Cloud Storage</a>
   <ul>
      <li><a href="51_cs_utilitzaci_des_de_lentorn.html" class="no-ch">5.1 CS: Utilització des de l'entorn</a></li>
      <li><a href="52_cs_utilitzaci_des_de_intellij.html" class="daddy">5.2 CS: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="521_csintellij_connexi.html" class="no-ch">5.2.1 CS-IntelliJ: Connexió</a></li>
         <li><a href="522_csintellij_accs_a_les_dades.html" class="no-ch">5.2.2 CS-IntelliJ: Accés a les dades</a></li>
         <li><a href="523_csintellij_tot_lexemple.html" class="no-ch">5.2.3 CS-IntelliJ: Tot l'exemple</a></li>
         <li><a href="524_csintellij_exemple_ampliat_combinant_amb_cloud_firestore.html" class="no-ch">5.2.4 CS-IntelliJ: Exemple ampliat, combinant amb Cloud Firestore</a></li>
      </ul>
      </li>
      <li class="current-page-parent"><a href="53_cs_utilitzaci_des_dandroid.html" class="current-page-parent daddy">5.3 CS: Utilització des d'Android</a>
      <ul>
         <li><a href="531_csandroid_connexi.html" class="no-ch">5.3.1 CS-Android: Connexió</a></li>
         <li><a href="532_csandroid_accs_als_fitxers.html" class="no-ch">5.3.2 CS-Android: Accés als fitxers</a></li>
         <li><a href="533_csandroid_tot_lexemple.html" class="no-ch">5.3.3 CS-Android: Tot l'exemple</a></li>
         <li id="active"><a href="534_csandroid_exemple_ampliat_combinant_amb_cloud_firestore.html" class="active no-ch">5.3.4 CS-Android: Exemple ampliat, combinant amb Cloud Firestore</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="533_csandroid_tot_lexemple.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">5.3.4 CS-Android: Exemple ampliat, combinant amb Cloud Firestore</h1></div>
<div class="iDevice_wrapper textIdevice" id="id249">
<div class="iDevice emphasis0" >
<div id="ta249_249_2" class="block iDevice_content">
<div class="exe-text"><p style="text-align: justify;">Anem a fer ara un exemple complet, d'una cosa que serà molt més real que fins ara: combinar <strong>Cloud Firestore</strong> amb <strong>Cloud Storage</strong>:</p>
<ul style="text-align: justify;">
<li>En Cloud Storage ens guardem les dades grans, com poden ser imatges, audios, vídeos, ...</li>
<li>En Cloud Firestore ens guardem totes les altres dades, i inclourem el nom de l'arxiu que hem guardat en Cloud Firestore</li>
</ul>
<p style="text-align: justify;">Per tant hem de combinar els accessos a les dues parts de Firebase, i haurem de comptar sobretot amb que les dades, tant en un com en l'altre, s'agafen de forma asíncrona, i per tant hem de cuidar de no utilitzar unes dades que potser encara no estan disponibles.</p>
<p style="text-align: justify;">El més correcte seria utilitzar <strong>corrutines</strong>, que juguen amb aquesta forma paral·lela d'executar les coses.</p>
<p style="text-align: justify;">Però per senzillesa començarem sense les corrutines, i senzillament haurem d'estar segurs de que les dades estan ja disponibles quan les utilitzem.</p>
<p style="text-align: justify;">Partirem del mateix exemple utilitzat en l'Annex d'Android, <strong>CoffeeShops_Fragment</strong>, i ara adequarem les dades a l'estructura de Firebase CloudFirestore, recordant que les imatges dels cafès estaran guardades en Cloud Storage. Aquesta és l'estructura de les dades:</p>
<table style="width: 100%;" border="1">
<tbody>
<tr>
<td style="width: 50%;"><img src="T7_5_3_4_1.png" alt="" width="651" height="407" /></td>
<td style="width: 50%;"><img src="T7_5_3_4_2.png" alt="" width="714" height="404" /></td>
</tr>
</tbody>
</table>
<p>Com veiem tenim una col·lecció anomenada <strong>CoffeeShops</strong> amb un document per cada cafè.</p>
<p>Dins del document del cafè tenim <strong>nom</strong>, <strong>adreca</strong>, <strong>punts</strong> i també el nom de la imatge guardada Cloud Storage. També tenim una col·lecció dins del document anomenada <strong>comentaris</strong>, i en cada document d'aquesta col·lecció de moment només tenim una parella clau-valor: <strong>comentari</strong></p>
<p>En la següent imatge es veuen els fitxers guardats en Cloud Storage. Per a que estiga un poc més organitzat, les hem deixades en la carpeta <strong>CoffeeShops </strong>: </p>
<p style="text-align: center;"><img src="T7_5_3_4_1.1.png" alt="" width="1319" height="650" /></p>
<p>Com hem dit partirem de l'exemple ja fet <strong>CoffeeShops_Fragments</strong>, no de <strong>CoffeeShops_Fragments_ROOM</strong>, perquè això ens obligaria a llevar moltes coses. Fins i tot per a que no es quede el nom anterior, potser siga convenient <strong>començar de zero amb un projecte nou</strong>.</p>
<p>Si és així:</p>
<ul>
<li>Creeu un nou projecte anomenat <strong>CoffeeShops_Fragments_FIREBASE</strong></li>
<li>Connecteu amb Cloud Firestore i Cloud Storage, utilitzant els assistents. Connectar l'aplicació només us farà falta en la primera ocasió, però incorporar llibreries, serà en cadascun dels casos.</li>
<li>Incorporeu la línia següent en el <strong>build.gradle</strong> de l'apliació, dins de <strong>android </strong> i dins de <strong>defaultConfig</strong>, per a que Cloud Firestore no done error:<strong><br /></strong></li>
</ul>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono', monospace; padding-left: 30px;">multiDexEnabled <span style="color: #0033b3;">true</span></pre>
<ul>
<li>També incorporarem en el <strong>build.gradle</strong> de l'aplicació les llibreries que ens permeten la navegació entre fragments. Han d'anar en la zona de <strong>dependencies</strong></li>
</ul>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono', monospace; padding-left: 30px;">implementation <span style="color: #067d17;">'androidx.navigation:navigation-fragment-ktx:2.3.1'<br /></span>implementation <span style="color: #067d17;">'androidx.navigation:navigation-ui-ktx:2.3.1'<br /></span></pre>
<ul>
<li>Copieu el següent contingut al fitxer <strong>strings.xml</strong>, que està dins de <strong>res -&gt; values</strong>. En ell s'estan definint cadenes que s'utilitzaran en diferents mòduls</li>
</ul>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;">&lt;<span style="color: #0033b3;">resources</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="app_name"</span>&gt;CoffeeShops_Fragments_FIREBASE&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="action_settings"</span>&gt;Settings&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    <span style="color: #8c8c8c; font-style: italic;">&lt;!-- Strings used for fragments for navigation --&gt;<br /></span><span style="color: #8c8c8c; font-style: italic;">    </span>&lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="first_fragment_label"</span>&gt;First Fragment&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="second_fragment_label"</span>&gt;Second Fragment&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="next"</span>&gt;Next&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="previous"</span>&gt;Previous&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="reserve"</span>&gt;Reserve&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="hello_first_fragment"</span>&gt;Hello first fragment&lt;/<span style="color: #0033b3;">string</span>&gt;<br />    &lt;<span style="color: #0033b3;">string </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="hello_second_fragment"</span>&gt;Hello second fragment. Arg: %1$s&lt;/<span style="color: #0033b3;">string</span>&gt;<br />&lt;/<span style="color: #0033b3;">resources</span>&gt;</pre>
<ul>
<li>També ens farà falta el fitxer del menú <strong>menu_main.xml</strong>, que ha d'estar en <strong>res -&gt; menu</strong></li>
</ul>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">menu </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">app</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">tools</span><span style="color: #067d17;">="http://schemas.android.com/tools"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">tools</span><span style="color: #174ad4;">:context</span><span style="color: #067d17;">=".MainActivity"</span>&gt;<br />    &lt;<span style="color: #0033b3;">item<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/action_settings"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:orderInCategory</span><span style="color: #067d17;">="100"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:title</span><span style="color: #067d17;">="@string/action_settings"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:showAsAction</span><span style="color: #067d17;">="never" </span>/&gt;<br />&lt;/<span style="color: #0033b3;">menu</span>&gt;</pre>
<ul>
<li>I per últim copieu el següent contingut al fitxer <strong>themes.xml</strong>, que està en <strong>res -&gt; values -&gt; themes</strong>, i on es defineixen uns estils utilitzats:</li>
</ul>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;">&lt;<span style="color: #0033b3;">resources </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">tools</span><span style="color: #067d17;">="http://schemas.android.com/tools"</span>&gt;<br />    <span style="color: #8c8c8c; font-style: italic;">&lt;!-- Base application theme. --&gt;<br /></span><span style="color: #8c8c8c; font-style: italic;">    </span>&lt;<span style="color: #0033b3;">style </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="Theme.CoffeeShops_Fragments_FIREBASE" </span><span style="color: #174ad4;">parent</span><span style="color: #067d17;">="Theme.MaterialComponents.DayNight.DarkActionBar"</span>&gt;<br />        <span style="color: #8c8c8c; font-style: italic;">&lt;!-- Primary brand color. --&gt;<br /></span><span style="color: #8c8c8c; font-style: italic;">        </span>&lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="colorPrimary"</span>&gt;@color/purple_500&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        &lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="colorPrimaryVariant"</span>&gt;@color/purple_700&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        &lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="colorOnPrimary"</span>&gt;@color/white&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        <span style="color: #8c8c8c; font-style: italic;">&lt;!-- Secondary brand color. --&gt;<br /></span><span style="color: #8c8c8c; font-style: italic;">        </span>&lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="colorSecondary"</span>&gt;@color/teal_200&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        &lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="colorSecondaryVariant"</span>&gt;@color/teal_700&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        &lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="colorOnSecondary"</span>&gt;@color/black&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        <span style="color: #8c8c8c; font-style: italic;">&lt;!-- Status bar color. --&gt;<br /></span><span style="color: #8c8c8c; font-style: italic;">        </span>&lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="android:statusBarColor" </span><span style="color: #871094;">tools</span><span style="color: #174ad4;">:targetApi</span><span style="color: #067d17;">="l"</span>&gt;?attr/colorPrimaryVariant&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        <span style="color: #8c8c8c; font-style: italic;">&lt;!-- Customize your theme here. --&gt;<br /></span><span style="color: #8c8c8c; font-style: italic;">    </span>&lt;/<span style="color: #0033b3;">style</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">style </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="Theme.CoffeeShops_Fragments_FIREBASE.NoActionBar"</span>&gt;<br />        &lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="windowActionBar"</span>&gt;false&lt;/<span style="color: #0033b3;">item</span>&gt;<br />        &lt;<span style="color: #0033b3;">item </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="windowNoTitle"</span>&gt;true&lt;/<span style="color: #0033b3;">item</span>&gt;<br />    &lt;/<span style="color: #0033b3;">style</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">style </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="Theme.CoffeeShops_Fragments_FIREBASE.AppBarOverlay" </span><span style="color: #174ad4;">parent</span><span style="color: #067d17;">="ThemeOverlay.AppCompat.Dark.ActionBar" </span>/&gt;<br /><br />    &lt;<span style="color: #0033b3;">style </span><span style="color: #174ad4;">name</span><span style="color: #067d17;">="Theme.CoffeeShops_Fragments_FIREBASE.PopupOverlay" </span><span style="color: #174ad4;">parent</span><span style="color: #067d17;">="ThemeOverlay.AppCompat.Light" </span>/&gt;<br />&lt;/<span style="color: #0033b3;">resources</span>&gt;</pre>
<p></p></div>
</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id250">
<div class="iDevice emphasis0" >
<div id="ta250_250_2" class="block iDevice_content">
<div class="exe-text"><p class="titolet">Classe Coffee</p>
<p>Per l'estructura de les dades, en què tenim guardat nom, adreça, punts i imatge (no ens fa falta per exemple el número de cafè ja que no ens fa falta una clau principal, com era el cas de Bases de Dades a travès de Room), i en concordància amb els components definits en l'aplicació anterior de <strong>CoffeeShops_Fragments</strong>, podem definir la classe <strong>Coffee</strong> d'aquesta manera:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="color: #0033b3;">import </span>java.io.<span style="color: #000000;">Serializable<br /></span><span style="color: #000000;"><br /></span><span style="color: #0033b3;">data class </span><span style="color: #000000;">Coffee </span>(<span style="color: #0033b3;">val </span><span style="color: #871094;">title</span>: <span style="color: #000000;">String</span>?, <span style="color: #0033b3;">val </span><span style="color: #871094;">subtitle</span>: <span style="color: #000000;">String</span>?,<br />                   <span style="color: #0033b3;">val </span><span style="color: #871094;">points</span>: <span style="color: #000000;">Int</span>?, <span style="color: #0033b3;">var </span><span style="color: #871094;">image</span>: <span style="color: #000000;">ByteArray</span>? ): <span style="color: #000000;">Serializable</span></pre>
<ul>
<li>La raó de definir totes les propietats com a <strong>val</strong> excepte la imatge que serà <strong>var</strong> és perquè la imatge la modificarem amb posterioritat</li>
<li>Ho definim com a Serializable per a poder passar tot l'objecte del primer fragment al segon, així si s'ha de visualitzar una altra vegada la imatge, ja la tenim disponible. Si només s'ha de visualitzar el nom del cafè, a banda dels seus comentaris, no faria falta passar tot l'objecte, només el nom.</li>
</ul>
<p>El <strong>layout</strong> associat serà <strong>item_coffee.xml</strong>, amb aquest aspecte:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">androidx.cardview.widget.CardView<br /></span><span style="color: #0033b3;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">card_view</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/card1"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginBottom</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginRight</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginLeft</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="450dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">card_view</span><span style="color: #174ad4;">:cardCornerRadius</span><span style="color: #067d17;">="8dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">card_view</span><span style="color: #174ad4;">:cardElevation</span><span style="color: #067d17;">="8dp"</span>&gt;<br /><br />        &lt;<span style="color: #0033b3;">LinearLayout<br /></span><span style="color: #0033b3;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginTop</span><span style="color: #067d17;">="200dp"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginLeft</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:orientation</span><span style="color: #067d17;">="vertical"</span>&gt;<br /><br />                &lt;<span style="color: #0033b3;">TextView<br /></span><span style="color: #0033b3;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/textView"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginTop</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:textSize</span><span style="color: #067d17;">="25sp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:textStyle</span><span style="color: #067d17;">="bold"</span>/&gt;<br /><br />                &lt;<span style="color: #0033b3;">FrameLayout<br /></span><span style="color: #0033b3;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginTop</span><span style="color: #067d17;">="8dp"</span>&gt;<br /><br />                        &lt;<span style="color: #0033b3;">RatingBar<br /></span><span style="color: #0033b3;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/ratingBar"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:max</span><span style="color: #067d17;">="5"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:numStars</span><span style="color: #067d17;">="5"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:scaleX</span><span style="color: #067d17;">="0.5"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:scaleY</span><span style="color: #067d17;">="0.5"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:transformPivotX</span><span style="color: #067d17;">="0dp"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:transformPivotY</span><span style="color: #067d17;">="0dp" </span>/&gt;<br /><br />                        &lt;<span style="color: #0033b3;">TextView<br /></span><span style="color: #0033b3;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/textView2"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginLeft</span><span style="color: #067d17;">="130dp"<br /></span><span style="color: #067d17;">                            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="0" </span>/&gt;<br />                &lt;/<span style="color: #0033b3;">FrameLayout</span>&gt;<br /><br />                &lt;<span style="color: #0033b3;">TextView<br /></span><span style="color: #0033b3;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/textView1"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginTop</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:textSize</span><span style="color: #067d17;">="18sp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginBottom</span><span style="color: #067d17;">="16dp"</span>/&gt;<br /><br />                &lt;<span style="color: #0033b3;">View<br /></span><span style="color: #0033b3;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/divider"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="1dp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginRight</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:background</span><span style="color: #067d17;">="?android:attr/listDivider" </span>/&gt;<br /><br />                &lt;<span style="color: #0033b3;">Button<br /></span><span style="color: #0033b3;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/BtnReserve"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="@string/reserve"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:textSize</span><span style="color: #067d17;">="18sp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginTop</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">                    </span><span style="color: #174ad4;">style</span><span style="color: #067d17;">="?android:attr/buttonBarButtonStyle" </span>/&gt;<br /><br />        &lt;/<span style="color: #0033b3;">LinearLayout</span>&gt;<br /><br />        &lt;<span style="color: #0033b3;">ImageView<br /></span><span style="color: #0033b3;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/img1"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="200dp"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:scaleType</span><span style="color: #067d17;">="centerCrop" </span>/&gt;<br /><br />&lt;/<span style="color: #0033b3;">androidx.cardview.widget.CardView</span>&gt;</pre>
<p>El seu adapter, <strong>CoffeeAdapter</strong>, quedaria així:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="color: #0033b3;">import </span>android.graphics.<span style="color: #000000;">BitmapFactory<br /></span><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">LayoutInflater<br /></span><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">View<br /></span><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">ViewGroup<br /></span><span style="color: #0033b3;">import </span>android.widget.<span style="color: #000000;">ImageView<br /></span><span style="color: #0033b3;">import </span>android.widget.<span style="color: #000000;">RatingBar<br /></span><span style="color: #0033b3;">import </span>android.widget.<span style="color: #000000;">TextView<br /></span><span style="color: #0033b3;">import </span>androidx.recyclerview.widget.<span style="color: #000000;">RecyclerView<br /></span><span style="color: #000000;"><br /></span><span style="color: #0033b3;">class </span><span style="color: #000000;">CoffeeAdapter</span>(<span style="color: #0033b3;">private val </span><span style="color: #871094;">items</span>: <span style="color: #000000;">ArrayList</span>&lt;<span style="color: #000000;">Coffee</span>&gt;) : <span style="color: #000000;">RecyclerView</span>.Adapter&lt;<span style="color: #000000;">CoffeeAdapter</span>.<span style="color: #000000;">CoffeeViewHolder</span>&gt;() {<br /><br />    <span style="color: #0033b3;">lateinit var </span><span style="color: #871094;">onClick</span>: (<span style="color: #000000;">View</span>) -&gt; <span style="color: #000000;">Unit<br /></span><span style="color: #000000;"><br /></span><span style="color: #000000;">    </span><span style="color: #0033b3;">class </span><span style="color: #000000;">CoffeeViewHolder</span>(itemView: <span style="color: #000000;">View</span>) : <span style="color: #000000;">RecyclerView</span>.ViewHolder(itemView) {<br />        <span style="color: #0033b3;">private val </span><span style="color: #871094;">image</span>: <span style="color: #000000;">ImageView<br /></span><span style="color: #000000;">        </span><span style="color: #0033b3;">private val </span><span style="color: #871094;">text</span>: <span style="color: #000000;">TextView<br /></span><span style="color: #000000;">        </span><span style="color: #0033b3;">private val </span><span style="color: #871094;">text1</span>: <span style="color: #000000;">TextView<br /></span><span style="color: #000000;">        </span><span style="color: #0033b3;">private val </span><span style="color: #871094;">barstars</span>: <span style="color: #000000;">RatingBar<br /></span><span style="color: #000000;">        </span><span style="color: #0033b3;">private val </span><span style="color: #871094;">points</span>: <span style="color: #000000;">TextView<br /></span><span style="color: #000000;"><br /></span><span style="color: #000000;">        </span><span style="color: #0033b3;">init </span>{<br /><br />            <span style="color: #871094;">image </span>= itemView.findViewById(<span style="color: #000000;">R</span>.<span style="color: #000000;">id</span>.<span style="color: #871094; font-style: italic;">img1</span>)<br />            <span style="color: #871094;">text </span>= itemView.findViewById(<span style="color: #000000;">R</span>.<span style="color: #000000;">id</span>.<span style="color: #871094; font-style: italic;">textView</span>)<br />            <span style="color: #871094;">text1 </span>= itemView.findViewById(<span style="color: #000000;">R</span>.<span style="color: #000000;">id</span>.<span style="color: #871094; font-style: italic;">textView1</span>)<br />            <span style="color: #871094;">points </span>= itemView.findViewById(<span style="color: #000000;">R</span>.<span style="color: #000000;">id</span>.<span style="color: #871094; font-style: italic;">textView2</span>)<br />            <span style="color: #871094;">barstars </span>= itemView.findViewById(<span style="color: #000000;">R</span>.<span style="color: #000000;">id</span>.<span style="color: #871094; font-style: italic;">ratingBar</span>)<br />        }<br /><br />        <span style="color: #0033b3;">fun </span><span style="color: #00627a;">bindCards</span>(t: <span style="color: #000000;">Coffee</span>, onClick: (<span style="color: #000000;">View</span>) -&gt; <span style="color: #000000;">Unit</span>) {<br />            <span style="color: #8c8c8c; font-style: italic;">//image.setImageResource(t.image)<br /></span><span style="color: #8c8c8c; font-style: italic;">            </span><span style="color: #0033b3;">val </span><span style="color: #000000;">img </span>= t.<span style="color: #871094;">image<br /></span><span style="color: #871094;">            </span><span style="color: #0033b3;">if </span>(<span style="color: #000000;">img </span>!= <span style="color: #0033b3;">null</span>) {<br />                <span style="color: #0033b3;">val </span><span style="color: #000000;">imgBmp </span>= <span style="color: #000000;">BitmapFactory</span>.decodeByteArray(<span style="color: #000000;">img</span>, <span style="color: #1750eb;">0</span>, <span style="color: #000000;">img</span>.<span style="color: #871094;">size</span>)<br />                <span style="color: #871094;">image</span>.setImageBitmap(<span style="color: #000000;">imgBmp</span>)<br />            }<br />            <span style="color: #871094;">text</span>.<span style="color: #871094; font-style: italic;">text </span>= t.<span style="color: #871094;">title<br /></span><span style="color: #871094;">            text1</span>.<span style="color: #871094; font-style: italic;">text </span>= t.<span style="color: #871094;">subtitle<br /></span><span style="color: #871094;">            </span><span style="color: #0033b3;">if </span>(t.<span style="color: #871094;">points</span>!=<span style="color: #0033b3;">null</span>) {<br />                <span style="color: #871094;">barstars</span>.<span style="color: #871094; font-style: italic;">rating </span>= <span style="background-color: #dbffdb;">t.points</span>.toFloat()<br />                <span style="color: #871094;">points</span>.<span style="color: #871094; font-style: italic;">text</span>=<span style="background-color: #dbffdb;">t.points</span>.toString()<br />            }<br />            <span style="color: #871094;">barstars</span>.<span style="color: #871094; font-style: italic;">onRatingBarChangeListener </span>= <span style="color: #000000;">RatingBar</span>.OnRatingBarChangeListener <span style="font-weight: bold;">{ </span>ratingBar: <span style="color: #000000;">RatingBar</span>, fl: <span style="color: #000000;">Float</span>, b: <span style="color: #000000;">Boolean </span><span style="font-weight: bold;">-&gt;<br /></span><span style="font-weight: bold;">                    </span><span style="color: #871094;">points</span>.<span style="color: #871094; font-style: italic;">text </span>= fl.toString()<br />                <span style="font-weight: bold;">}<br /></span><span style="font-weight: bold;">            </span><span style="color: #871094;">itemView</span>.setOnClickListener<span style="font-weight: bold;">{ </span><span style="color: #000000;">onClick</span>(<span style="color: #871094;">itemView</span>) <span style="font-weight: bold;">}<br /></span><span style="font-weight: bold;">        </span>}<br />    }<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">onCreateViewHolder</span>(viewGroup: <span style="color: #000000;">ViewGroup</span>, viewType: <span style="color: #000000;">Int</span>): <span style="color: #000000;">CoffeeViewHolder </span>{<br />        <span style="color: #0033b3;">val </span><span style="color: #000000;">itemView </span>= <span style="color: #000000;">LayoutInflater</span>.from(viewGroup.<span style="color: #871094; font-style: italic;">context</span>).inflate(<span style="color: #000000;">R</span>.<span style="color: #000000;">layout</span>.<span style="color: #871094; font-style: italic;">item_coffee</span>, viewGroup, <span style="color: #0033b3;">false</span>)<br />        <span style="color: #0033b3;">return </span>CoffeeViewHolder(<br />            <span style="color: #000000;">itemView<br /></span><span style="color: #000000;">        </span>)<br />    }<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">onBindViewHolder</span>(viewHolder: <span style="color: #000000;">CoffeeViewHolder</span>, pos: <span style="color: #000000;">Int</span>) {<br />        <span style="color: #0033b3;">val </span><span style="color: #000000;">item </span>= <span style="color: #871094;">items</span>[pos]<br />        viewHolder.bindCards(<span style="color: #000000;">item</span>, <span style="color: #871094;">onClick</span>)<br />    }<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">getItemCount</span>(): <span style="color: #000000;">Int </span>{<br />        <span style="color: #0033b3;">return </span><span style="color: #871094;">items</span>.<span style="color: #871094;">size<br /></span><span style="color: #871094;">    </span>}<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">getItemViewType</span>(position: <span style="color: #000000;">Int</span>): <span style="color: #000000;">Int </span>{<br />        <span style="color: #0033b3;">return </span>position<br />    }<br />}</pre>
<p></p></div>
</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id251">
<div class="iDevice emphasis0" >
<div id="ta251_251_2" class="block iDevice_content">
<div class="exe-text"><p class="titolet">Classe Comment</p>
<p>El comentari de moment el tenim molt senzill. Segurament estaria bé gaurdar més coses, com la data del comentari i l'autor (a banda de valoracions al comentari). Seria tan senzill com fer aquesta classe més completa.</p>
<p>Però de moment només guardem el propi comentari, per tant la classe <strong>Comment</strong> queda així de senzilla:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="color: #0033b3;">data class </span><span style="color: #000000;">Comment </span>(<span style="color: #0033b3;">val </span><span style="color: #871094;">comm</span>: <span style="color: #000000;">String</span>?)</pre>
<p>El <strong>layout</strong> associat serà <strong>item_comment.xml</strong>, amb aquest aspecte:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">androidx.cardview.widget.CardView </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">app</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="100dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:cardElevation</span><span style="color: #067d17;">="6dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:cardCornerRadius</span><span style="color: #067d17;">="8dp"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_margin</span><span style="color: #067d17;">="6dp"</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">LinearLayout<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:orientation</span><span style="color: #067d17;">="vertical"</span>&gt;<br /><br />        &lt;<span style="color: #0033b3;">TextView<br /></span><span style="color: #0033b3;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/cita"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_margin</span><span style="color: #067d17;">="5dp"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="TextView" </span>/&gt;<br /><br />    &lt;/<span style="color: #0033b3;">LinearLayout</span>&gt;<br />&lt;/<span style="color: #0033b3;">androidx.cardview.widget.CardView</span>&gt;</pre>
<p>I el seu adapter, <strong>CommentsAdapter</strong>, així:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">LayoutInflater<br /></span><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">View<br /></span><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">ViewGroup<br /></span><span style="color: #0033b3;">import </span>android.widget.<span style="color: #000000;">TextView<br /></span><span style="color: #0033b3;">import </span>androidx.recyclerview.widget.<span style="color: #000000;">RecyclerView<br /></span><span style="color: #000000;"><br /></span><span style="color: #0033b3;">class </span><span style="color: #000000;">CommentsAdapter</span>(<span style="color: #0033b3;">private val </span><span style="color: #871094;">items</span>: <span style="color: #000000;">ArrayList</span>&lt;<span style="color: #000000;">Comment</span>&gt;) : <span style="color: #000000;">RecyclerView</span>.Adapter&lt;<span style="color: #000000;">CommentsAdapter</span>.<span style="color: #000000;">CoffeeViewHolder</span>&gt;() {<br /><br />    <span style="color: #0033b3;">class </span><span style="color: #000000;">CoffeeViewHolder</span>(itemView: <span style="color: #000000;">View</span>) : <span style="color: #000000;">RecyclerView</span>.ViewHolder(itemView) {<br /><br />        <span style="color: #0033b3;">private val </span><span style="color: #871094;">texto</span>: <span style="color: #000000;">TextView<br /></span><span style="color: #000000;"><br /></span><span style="color: #000000;">        </span><span style="color: #0033b3;">init </span>{<br />            <span style="color: #871094;">texto </span>= itemView.findViewById(<span style="color: #000000;">R</span>.<span style="color: #000000;">id</span>.<span style="color: #871094; font-style: italic;">cita</span>)<br />        }<br /><br />        <span style="color: #0033b3;">fun </span><span style="color: #00627a;">bindComment</span>(c: <span style="color: #000000;">Comment</span>) {<br />            <span style="color: #871094;">texto</span>.<span style="color: #871094; font-style: italic;">text </span>= c.<span style="color: #871094;">comm<br /></span><span style="color: #871094;">        </span>}<br />    }<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">onCreateViewHolder</span>(viewGroup: <span style="color: #000000;">ViewGroup</span>, viewType: <span style="color: #000000;">Int</span>): <span style="color: #000000;">CoffeeViewHolder </span>{<br />        <span style="color: #0033b3;">val </span><span style="color: #000000;">itemView </span>= <span style="color: #000000;">LayoutInflater</span>.from(viewGroup.<span style="color: #871094; font-style: italic;">context</span>).inflate(<span style="color: #000000;">R</span>.<span style="color: #000000;">layout</span>.<span style="color: #871094; font-style: italic;">item_comment</span>, viewGroup, <span style="color: #0033b3;">false</span>)<br />        <span style="color: #0033b3;">return </span>CoffeeViewHolder(<br />            <span style="color: #000000;">itemView<br /></span><span style="color: #000000;">        </span>)<br />    }<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">onBindViewHolder</span>(viewHolder: <span style="color: #000000;">CoffeeViewHolder</span>, pos: <span style="color: #000000;">Int</span>) {<br />        <span style="color: #0033b3;">val </span><span style="color: #000000;">item </span>= <span style="color: #871094;">items</span>[pos]<br />        viewHolder.bindComment(<span style="color: #000000;">item</span>)<br />    }<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">getItemCount</span>(): <span style="color: #000000;">Int </span>{<br />        <span style="color: #0033b3;">return </span><span style="color: #871094;">items</span>.<span style="color: #871094;">size<br /></span><span style="color: #871094;">    </span>}<br />}</pre>
<p></p>
<p></p>
<p></p></div>
</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id252">
<div class="iDevice emphasis0" >
<div id="ta252_252_2" class="block iDevice_content">
<div class="exe-text"><p class="titolet">FirstFragment</p>
<p>En aquesta aplicació de fragments, ballàvem entre 2 fragments. En el primer veiem les dades dels cafès: nom, adreça, puntuació i imatge. Els comentaris els deixàvem per al segon fragment.</p>
<p>El seu layout és <strong>fragment_first.xml</strong>, i té aquest aspecte:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">androidx.constraintlayout.widget.ConstraintLayout </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">app</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">tools</span><span style="color: #067d17;">="http://schemas.android.com/tools"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">tools</span><span style="color: #174ad4;">:context</span><span style="color: #067d17;">=".FirstFragment"</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">androidx.recyclerview.widget.RecyclerView<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/recView"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginTop</span><span style="color: #067d17;">="5dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintEnd_toEndOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintStart_toStartOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintTop_toTopOf</span><span style="color: #067d17;">="parent" </span>/&gt;<br />&lt;/<span style="color: #0033b3;">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</pre>
<p>I el programa corresponent al primer fragment, <strong>FirstFragment</strong>, és on tenim més feina:</p>
<ul>
<li>Ens connectem a <strong>CloudFirestore</strong> per a agafar tots els documents de la col·lecció <strong>CoffeeShops</strong> per mig d'un <strong>addSnapshotListener</strong>, que buscarà tots els documents de la col·lecció (línia 39)</li>
<li>Construïm l'objecte <strong>Coffee</strong>, però sense haver agafat encara la imatge (per això havíem definit la propietat com a var), perquè com haurem de buscar-la a Cloud Storage, en el moment de construir l'objecte no la tindríem. Per tant de moment no tenim res en la propietat <strong>image</strong> de l'objecte (línies 47 a 50)</li>
<li>L'objecte <strong>Coffee</strong> l'afegim a l'ArrayList&lt;Coffee&gt; anomenat <strong>items </strong>(línia 47)</li>
<li>En un altre ArrayList&lt;String&gt; anomenat <strong>itemsDocs </strong>ens guardarem el nom del document. Això és per fer més senzilla la recerca del document amb posterioritat (quan busquem els seus comentaris) (línia 51)</li>
<li>Llancem la recerca de la imatge en Cloud Storage (línia 58). Observeu que en el moment d'agafar la referència, en el nom de la imatge hem incorporat la carpeta <strong>CoffeeShops</strong> (línia 56)</li>
<li>Quan estiga disponible l'assignarem al <strong>item</strong> corresponent (línia 61)</li>
<li>Ens hem d'assegurar que quan anem a crear l'adaptador CoffeeAdaptor, tots els items estiguen creats. Per això en muntem un <strong>addOnSuccessListener</strong> també sobre la col·lecció. Firebase ens assegura que s'activarà <strong>després </strong>del <strong>addOnSnapshotListener</strong>, per tant és una bona manera d'assegurar-nos que ja estan creats tots els items (faltarà per omplir les imatges, però els items amb els objectes Coffee ja estaran creats) (línia 72 i següents)</li>
<li>En el <strong>onClick</strong> de l'adaptador, cridarem al segon fragment, passant 2 paràmetres per mig del <strong>bundle</strong> (línia 83):
<ul>
<li>L'objecte <strong>Coffee</strong> del qual volem els comentaris. Podríem passar només el nom del cafè, però d'aquesta manera si per exemple es vol visualitzar la imatge, es pot fer. És per a poder passar tot l'objecte <strong>Coffee</strong> que declarem la classe com a <strong>Serializable</strong></li>
<li>Passem també el nom del document corresponent a aquest cafè, per a poder llegir la seua col·lecció de comentaris més fàcilment (línia 81)</li>
</ul>
</li>
</ul>
<div class="highlighted-code language-java line-numbers">
<div>
<pre><code>package com.example.coffeeshops_fragments_firebase

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.core.os.bundleOf
import androidx.fragment.app.Fragment
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView
import com.google.android.gms.tasks.OnFailureListener
import com.google.android.gms.tasks.OnSuccessListener
import com.google.firebase.firestore.DocumentChange
import com.google.firebase.firestore.FirebaseFirestore
import com.google.firebase.storage.FirebaseStorage
import com.google.firebase.storage.StorageReference

/**
 * A simple [Fragment] subclass as the default destination in the navigation.
 */
class FirstFragment : Fragment() {

    private var items: ArrayList&lt;Coffee&gt; = ArrayList()
    private var itemsDocs: ArrayList&lt;String&gt; = ArrayList()

    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {

        val root = inflater.inflate(R.layout.fragment_first, container, false)
        val db: FirebaseFirestore = FirebaseFirestore.getInstance()

        if (items.size==0) {  // per a no executar-lo una altra vegada quan tornem del SecondFragment
            val storageRef: StorageReference;
            storageRef = FirebaseStorage.getInstance().getReference();

            db.collection("CoffeeShops").addSnapshotListener { snapshots, e -&gt;
                for (dc in snapshots!!.documentChanges) {
                    when (dc.type) {
                        DocumentChange.Type.ADDED -&gt; {
                            var p = 0
                            if (dc.document.getString("punts")!="")
                                p = dc.document.get("punts").toString().toInt()

                            items!!.add(Coffee(dc.document.getString("nom").toString(),
                                dc.document.getString("adreca").toString(),
                                p, null
                            ))
                            itemsDocs.add(dc.document.id)
                            val item = items[items.size-1]
                            val nomImatge = dc.document.getString("imatge")

                            if (nomImatge != null) {
                                val imatgeRef = storageRef.child("CoffeeShops/" + nomImatge)
                                val ONE_MEGABYTE = (1024 * 1024).toLong()
                                imatgeRef.getBytes(ONE_MEGABYTE)
                                        .addOnSuccessListener(OnSuccessListener&lt;ByteArray&gt; {
                                            // Data for "images/island.jpg" is returns, use this as needed
                                            item.image=it
                                        }).addOnFailureListener(OnFailureListener {
                                            // Handle any errors
                                        })
                            }
                        }
                    }
                }
            }
        }

        db.collection("CoffeeShops").get().addOnSuccessListener {
            val recView: RecyclerView = root.findViewById(R.id.recView)
            recView.setHasFixedSize(true)
            val adaptador = CoffeeAdapter(items)
            recView.adapter = adaptador
            recView.layoutManager = LinearLayoutManager(context, LinearLayoutManager.VERTICAL, false)

            adaptador.onClick = {
                val c = items[recView.getChildAdapterPosition(it)]
                val d = itemsDocs[recView.getChildAdapterPosition(it)]
                val bundle = bundleOf("coffee" to c,"doc" to d)
                findNavController().navigate(R.id.action_FirstFragment_to_SecondFragment, bundle)
            }
        }
        return root
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        }
}</code></pre>
</div>
</div>
<p>De moment marcarà un error en la línia 83, perquè no està definida la navegació (la incorporarem al final)</p>
<p></p></div>
</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id253">
<div class="iDevice emphasis0" >
<div id="ta253_253_2" class="block iDevice_content">

</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id254">
<div class="iDevice emphasis0" >
<div id="ta254_254_2" class="block iDevice_content">
<div class="exe-text"><p class="titolet">Second Fragment</p>
<p>L'utilitzem per a visualitzar els comentaris del cafè seleccionat (sobre qui es fa un click).</p>
<p>El layout associat és <strong>fragment_second.xml</strong>, i té aquest aspecte:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">androidx.constraintlayout.widget.ConstraintLayout </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">app</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">tools</span><span style="color: #067d17;">="http://schemas.android.com/tools"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">tools</span><span style="color: #174ad4;">:context</span><span style="color: #067d17;">=".SecondFragment"</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">TextView<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/textview_second"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="0dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginTop</span><span style="color: #067d17;">="56dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:gravity</span><span style="color: #067d17;">="center"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="Segundo Fragment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:textSize</span><span style="color: #067d17;">="20sp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:textStyle</span><span style="color: #067d17;">="bold"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintEnd_toEndOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintStart_toStartOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintTop_toTopOf</span><span style="color: #067d17;">="parent" </span>/&gt;<br /><br />    &lt;<span style="color: #0033b3;">androidx.recyclerview.widget.RecyclerView<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/recyclerview_coment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="0dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginStart</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_marginEnd</span><span style="color: #067d17;">="16dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintBottom_toBottomOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintEnd_toEndOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintHorizontal_bias</span><span style="color: #067d17;">="0.0"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintStart_toStartOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintTop_toBottomOf</span><span style="color: #067d17;">="@+id/textview_second"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintVertical_bias</span><span style="color: #067d17;">="0.158" </span>/&gt;<br /><br />&lt;/<span style="color: #0033b3;">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</pre>
<p>A aquest fragment, <strong>SecondFragment</strong>, recordem que li passem 2 paràmetres:</p>
<ul>
<li>L'objecte <strong>Coffee</strong> del qual volem els comentaris.<strong></strong></li>
<li>El nom del document corresponent a aquest cafè</li>
</ul>
<p>El funcionament és el següent:</p>
<ul>
<li>Agafem els paràmetres passats en <strong>coffee</strong> i <strong>nameDoc</strong> (línies 30 i 31)</li>
<li>Sobre la col·lecció <strong>comentaris</strong> del document (per això ha estat còmode passar-li el nom del document) muntem un <strong>addSnapshotListener</strong>, per a obtindre tots els documents de la col·lecció (línia 33)</li>
<li>És de ressaltar que com tal i com ho fem, no podem assegurar l'ordre en què vindran aquestos documents, i per tant quin serà l'ordre dels comentaris. El més lògic seria ordenar-los cronològicament. Per a això podríem afegir al document del comentari un camp amb la data-hora. Aleshores afegiríem a aquesta sentència de la línia 33 una clàusula d'ordenació; <strong>orderBy("date")</strong>, si s'anomenara <strong>date</strong> aquest camp amb la data</li>
<li>Anem afegint els comentaris a un <strong>ArrayList&lt;Comment&gt;</strong> anomenat <strong>Comments</strong></li>
<li>En el moment de crear l'adaptador dels comentaris hem d'estar segurs que ja tenim disponibles tots els comentaris en <strong>Comments</strong>. Amb aquesta finalitat muntem un <strong>addOnSuccessListener </strong>també sobre la col·lecció <strong>c</strong><strong>omentaris</strong>. Firebase ens assegura que aquest es produirà després del <strong>addSnapshotListener</strong> i per tant ja tindrem l'ArrayList ple (línia 45)</li>
</ul>
<p>I aquest és el <strong>SecondFragment</strong>:</p>
<div class="highlighted-code language-java line-numbers">
<div>
<pre><code>package com.example.coffeeshops_fragments_firebase

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import androidx.fragment.app.Fragment
import androidx.recyclerview.widget.GridLayoutManager
import androidx.recyclerview.widget.RecyclerView
import com.google.firebase.firestore.DocumentChange
import com.google.firebase.firestore.FirebaseFirestore

/**
 * A simple [Fragment] subclass as the second destination in the navigation.
 */
class SecondFragment : Fragment() {

    private var Comments = arrayListOf&lt;Comment&gt;()

    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        // Inflate the layout for this fragment
        val db: FirebaseFirestore = FirebaseFirestore.getInstance()

        val root = inflater.inflate(R.layout.fragment_second, container, false)
        val texto: TextView =  root.findViewById(R.id.textview_second)
        val coffee = arguments?.get("coffee") as Coffee
        val nameDoc = arguments?.get("doc") as String
        texto.text = coffee.title
        db.collection("CoffeeShops").document(nameDoc).collection("comentaris").addSnapshotListener { snapshots, e -&gt;
            for (dc in snapshots!!.documentChanges) {
                when (dc.type) {
                    DocumentChange.Type.ADDED -&gt; {
                        Comments.add(Comment(dc.document.getString("comentari")))
                    }
                }
            }
        }

        val recView: RecyclerView = root.findViewById(R.id.recyclerview_coment)
        recView.setHasFixedSize(true)
        db.collection("CoffeeShops").document(nameDoc).collection("comentari").
                get().addOnSuccessListener {
            val adaptador = CommentsAdapter(Comments)

            recView.adapter = adaptador
            recView.layoutManager = GridLayoutManager(context, 2)

        }
        val adaptador = CommentsAdapter(Comments)

        recView.adapter = adaptador
        recView.layoutManager = GridLayoutManager(context, 2)

        return root
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

      /*  view.findViewById&lt;Button&gt;(R.id.button_second).setOnClickListener {
           findNavController().navigate(R.id.action_SecondFragment_to_FirstFragment)
        }*/
    }
}</code></pre>
</div>
</div>
<p></p></div>
</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id255">
<div class="iDevice emphasis0" >
<div id="ta255_255_2" class="block iDevice_content">

</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id256">
<div class="iDevice emphasis0" >
<div id="ta256_256_2" class="block iDevice_content">

</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id257">
<div class="iDevice emphasis0" >
<div id="ta257_257_2" class="block iDevice_content">
<div class="exe-text"><p class="titolet">Main Activity i navegació</p>
<p>El MainActivity no ofereix cap dificultat:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="color: #0033b3;">import </span>android.os.<span style="color: #000000;">Bundle<br /></span><span style="color: #0033b3;">import </span>androidx.appcompat.app.<span style="color: #000000;">AppCompatActivity<br /></span><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">Menu<br /></span><span style="color: #0033b3;">import </span>android.view.<span style="color: #000000;">MenuItem<br /></span><span style="color: #000000;"><br /></span><span style="color: #0033b3;">class </span><span style="color: #000000;">MainActivity </span>: AppCompatActivity() {<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">onCreate</span>(savedInstanceState: <span style="color: #000000;">Bundle</span>?) {<br />        <span style="color: #0033b3;">super</span>.onCreate(savedInstanceState)<br />        setContentView(<span style="color: #000000;">R</span>.<span style="color: #000000;">layout</span>.<span style="color: #871094; font-style: italic;">activity_main</span>)<br />        }<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">onCreateOptionsMenu</span>(menu: <span style="color: #000000;">Menu</span>): <span style="color: #000000;">Boolean </span>{<br />        <span style="color: #8c8c8c; font-style: italic;">// Inflate the menu; this adds items to the action bar if it is present.<br /></span><span style="color: #8c8c8c; font-style: italic;">        </span><span style="color: #871094; font-style: italic;">menuInflater</span>.inflate(<span style="color: #000000;">R</span>.<span style="color: #000000;">menu</span>.<span style="color: #871094; font-style: italic;">menu_main</span>, menu)<br />        <span style="color: #0033b3;">return true<br /></span><span style="color: #0033b3;">    </span>}<br /><br />    <span style="color: #0033b3;">override fun </span><span style="color: #00627a;">onOptionsItemSelected</span>(item: <span style="color: #000000;">MenuItem</span>): <span style="color: #000000;">Boolean </span>{<br />        <span style="color: #8c8c8c; font-style: italic;">// Handle action bar item clicks here. The action bar will<br /></span><span style="color: #8c8c8c; font-style: italic;">        // automatically handle clicks on the Home/Up button, so long<br /></span><span style="color: #8c8c8c; font-style: italic;">        // as you specify a parent activity in AndroidManifest.xml.<br /></span><span style="color: #8c8c8c; font-style: italic;">        </span><span style="color: #0033b3;">return when </span>(item.<span style="color: #871094; font-style: italic;">itemId</span>) {<br />            <span style="color: #000000;">R</span>.<span style="color: #000000;">id</span>.<span style="color: #871094; font-style: italic;">action_settings </span>-&gt; <span style="color: #0033b3;">true<br /></span><span style="color: #0033b3;">            else </span>-&gt; <span style="color: #0033b3;">super</span>.onOptionsItemSelected(item)<br />        }<br />    }<br />}</pre>
<p>Maracrà uns errors, perquè redefinirem <strong>activity_main.xml</strong> amb alguns elements que falten</p>
<p>I en el seu layout, <strong>activity_main.xml</strong>, només hem d'observar que en ell inclourem un altre layout en la penúltima línia, el <strong>content_main</strong>:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">androidx.coordinatorlayout.widget.CoordinatorLayout </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">app</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">tools</span><span style="color: #067d17;">="http://schemas.android.com/tools"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">tools</span><span style="color: #174ad4;">:context</span><span style="color: #067d17;">=".MainActivity"</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">com.google.android.material.appbar.AppBarLayout<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:theme</span><span style="color: #067d17;">="@style/Theme.CoffeeShops_Fragments_FIREBASE.AppBarOverlay"</span>&gt;<br /><br />        &lt;<span style="color: #0033b3;">androidx.appcompat.widget.Toolbar<br /></span><span style="color: #0033b3;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/toolbar"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="?attr/actionBarSize"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:background</span><span style="color: #067d17;">="?attr/colorPrimary"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:popupTheme</span><span style="color: #067d17;">="@style/Theme.CoffeeShops_Fragments_FIREBASE.PopupOverlay" </span>/&gt;<br /><br />    &lt;/<span style="color: #0033b3;">com.google.android.material.appbar.AppBarLayout</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">include </span><span style="color: #174ad4;">layout</span><span style="color: #067d17;">="@layout/content_main" </span>/&gt;<br /><br />&lt;/<span style="color: #0033b3;">androidx.coordinatorlayout.widget.CoordinatorLayout</span>&gt;</pre>
<p>Marcarà error en la penúltima fila, perquè ens falta definir el <strong>content_main.xml</strong></p>
<p>En el mencionat <strong>content_main.xml </strong>només assenyalem que utilitzarem el <strong>navigation/nav_graph</strong><strong>:</strong></p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">androidx.constraintlayout.widget.ConstraintLayout </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">app</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_behavior</span><span style="color: #067d17;">="@string/appbar_scrolling_view_behavior"</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">fragment<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/nav_host_fragment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:name</span><span style="color: #067d17;">="androidx.navigation.fragment.NavHostFragment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="0dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="0dp"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:defaultNavHost</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintBottom_toBottomOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintLeft_toLeftOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintRight_toRightOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:layout_constraintTop_toTopOf</span><span style="color: #067d17;">="parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:navGraph</span><span style="color: #067d17;">="@navigation/nav_graph" </span>/&gt;<br />&lt;/<span style="color: #0033b3;">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</pre>
<p>I és en el <strong>nav_graph.xml</strong> on es dissenya la manera de navegar. S'ha de crear sobre <strong>res -&gt; New -&gt; Android Resource File</strong>, amb el nom especificat (no cal posar .xml) i cuidant que siga en recurs de tipus <strong>Navigation</strong></p>
<p><img src="T7_5_3_4_4.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" width="824" height="496" /></p>
<p>I aquest ha de ser el seu contingut</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">navigation </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">app</span><span style="color: #067d17;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">tools</span><span style="color: #067d17;">="http://schemas.android.com/tools"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/nav_graph"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:startDestination</span><span style="color: #067d17;">="@id/FirstFragment"</span>&gt;<br /><br />    &lt;<span style="color: #0033b3;">fragment<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/FirstFragment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:name</span><span style="color: #067d17;">="com.example.coffeeshops_fragments_firebase.FirstFragment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:label</span><span style="color: #067d17;">="@string/first_fragment_label"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">tools</span><span style="color: #174ad4;">:layout</span><span style="color: #067d17;">="@layout/fragment_first"</span>&gt;<br /><br />        &lt;<span style="color: #0033b3;">action<br /></span><span style="color: #0033b3;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/action_FirstFragment_to_SecondFragment"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:destination</span><span style="color: #067d17;">="@id/SecondFragment" </span>/&gt;<br />    &lt;/<span style="color: #0033b3;">fragment</span>&gt;<br />    &lt;<span style="color: #0033b3;">fragment<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/SecondFragment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:name</span><span style="color: #067d17;">="com.example.coffeeshops_fragments_firebase.SecondFragment"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:label</span><span style="color: #067d17;">="@string/second_fragment_label"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">tools</span><span style="color: #174ad4;">:layout</span><span style="color: #067d17;">="@layout/fragment_second"</span>&gt;<br /><br />        &lt;<span style="color: #0033b3;">action<br /></span><span style="color: #0033b3;">            </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/action_SecondFragment_to_FirstFragment"<br /></span><span style="color: #067d17;">            </span><span style="color: #871094;">app</span><span style="color: #174ad4;">:destination</span><span style="color: #067d17;">="@id/FirstFragment" </span>/&gt;<br />    &lt;/<span style="color: #0033b3;">fragment</span>&gt;<br />&lt;/<span style="color: #0033b3;">navigation</span>&gt;</pre>
<p>En el moment de crear aquest fitxer, haurien de desaparèixer tots els errors</p>
<p><strong></strong></p></div>
</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id258">
<div class="iDevice emphasis0" >
<div id="ta258_258_2" class="block iDevice_content">
<div class="exe-text"><p>Si tot ha anat bé, es veurà com en executar, ràpidament apareixen les caixes de cada cafeteria, però potser encara no aparega la imatge. A poc a poc aniran apareixent. I si s'apreta a alguna cafeteria,anirem a veure els comentaris en el segon fragment</p>
<table style="width: 100%; height: 10px;" border="0">
<tbody>
<tr style="height: 10px;">
<td style="width: 50%; height: 10px; text-align: right;"><img src="T7_5_3_4_5.png" alt="" width="315" height="583" /></td>
<td style="width: 50%; height: 10px;"><img src="T7_5_3_4_6.png" alt="" width="315" height="583" /></td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="533_csandroid_tot_lexemple.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-nd">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Llicència Creative Commons Reconeixement NoComercial SenseObraDerivada 4.0</a></p>
</div>
</div>
</div>
</div>
</body></html>