<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>Exercicis | Bases de Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-12"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Bases de Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 7: FIREBASE</a></li>
   <li><a href="1__introducci_firebase.html" class="no-ch">1 - Introducció: Firebase</a></li>
   <li><a href="2__creaci_duna_aplicaci.html" class="no-ch">2 - Creació d'una aplicació</a></li>
   <li><a href="3__realtime_database_rd.html" class="daddy">3 - Realtime Database (RD)</a>
   <ul class="other-section">
      <li><a href="31_rd_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">3.1 RD: Utilització des de l'entorn de Firebase</a></li>
      <li><a href="32_rd_utilitzaci_des_de_intellij.html" class="daddy">3.2 RD: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="321_rdintellij_connexi_des_de_kotlin.html" class="no-ch">3.2.1 RD-IntelliJ: Connexió des de Kotlin</a></li>
         <li><a href="322_rdintellij_accs_a_les_dades.html" class="no-ch">3.2.2 RD-IntelliJ: Accés a les dades</a></li>
         <li><a href="323_rdintellij_tot_lexemple.html" class="no-ch">3.2.3 RD-IntelliJ: Tot l'exemple</a></li>
      </ul>
      </li>
      <li><a href="33_rd_utilitzaci_des_dandroid.html" class="daddy">3.3 RD: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="331_rdandroid_connexi_des_dandroid.html" class="no-ch">3.3.1 RD-Android: Connexió des d'Android</a></li>
         <li><a href="332_rdandroid_accs_a_les_dades.html" class="no-ch">3.3.2 RD-Android: Accés a les dades</a></li>
         <li><a href="333_rdandroid_tot_lexemple.html" class="no-ch">3.3.3 RD-Android: Tot l'exemple</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="4__cloud_firestore_cf.html" class="daddy">4 - Cloud Firestore (CF)</a>
   <ul class="other-section">
      <li><a href="41_cf_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">4.1 CF: Utilització des de l'entorn de Firebase</a></li>
      <li><a href="42_cf_utilitzaci_des_de_intellij.html" class="daddy">4.2 CF: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="421_cfintellij_connexi_des_de_kotlin.html" class="no-ch">4.2.1 CF-IntelliJ: Connexió des de Kotlin</a></li>
         <li><a href="422_cfintellij_accs_a_les_dades.html" class="no-ch">4.2.2 CF-IntelliJ: Accés a les dades</a></li>
         <li><a href="423_cfintellij_tot_lexemple.html" class="no-ch">4.2.3 CF-IntelliJ: Tot l'exemple</a></li>
         <li><a href="424_cfintellij_exemple_ampliat.html" class="no-ch">4.2.4 CF-IntelliJ: Exemple ampliat</a></li>
      </ul>
      </li>
      <li><a href="43_cf_utilitzaci_des_dandroid.html" class="daddy">4.3 CF: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="431_cfandroid_connexi.html" class="no-ch">4.3.1 CF-Android: Connexió</a></li>
         <li><a href="432_cfandroid_accs_a_les_dades.html" class="no-ch">4.3.2 CF-Android: Accés a les dades</a></li>
         <li><a href="433_cfandroid_tot_lexemple.html" class="no-ch">4.3.3 CF-Android: Tot l'exemple</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="5__cloud_storage.html" class="daddy">5 - Cloud Storage</a>
   <ul class="other-section">
      <li><a href="51_cs_utilitzaci_des_de_lentorn.html" class="no-ch">5.1 CS: Utilització des de l'entorn</a></li>
      <li><a href="52_cs_utilitzaci_des_de_intellij.html" class="daddy">5.2 CS: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="521_csintellij_connexi.html" class="no-ch">5.2.1 CS-IntelliJ: Connexió</a></li>
         <li><a href="522_csintellij_accs_a_les_dades.html" class="no-ch">5.2.2 CS-IntelliJ: Accés a les dades</a></li>
         <li><a href="523_csintellij_tot_lexemple.html" class="no-ch">5.2.3 CS-IntelliJ: Tot l'exemple</a></li>
         <li><a href="524_csintellij_exemple_ampliat_combinant_amb_cloud_firestore.html" class="no-ch">5.2.4 CS-IntelliJ: Exemple ampliat, combinant amb Cloud Firestore</a></li>
      </ul>
      </li>
      <li><a href="53_cs_utilitzaci_des_dandroid.html" class="daddy">5.3 CS: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="531_csandroid_connexi.html" class="no-ch">5.3.1 CS-Android: Connexió</a></li>
         <li><a href="532_csandroid_accs_als_fitxers.html" class="no-ch">5.3.2 CS-Android: Accés als fitxers</a></li>
         <li><a href="533_csandroid_tot_lexemple.html" class="no-ch">5.3.3 CS-Android: Tot l'exemple</a></li>
         <li><a href="534_csandroid_exemple_ampliat_combinant_amb_cloud_firestore.html" class="no-ch">5.3.4 CS-Android: Exemple ampliat, combinant amb Cloud Firestore</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li id="active"><a href="exercicis.html" class="active no-ch">Exercicis</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="534_csandroid_exemple_ampliat_combinant_amb_cloud_firestore.html" class="prev"><span><span>&laquo; </span>Anterior</span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">Exercicis</h1></div>
<div class="iDevice_wrapper activityIdevice em_iDevice em_iDevice_activity" id="id152">
<div class="iDevice emphasis1" >
<img alt="" class="iDevice_icon" src="icon_activity.gif" /><h2 class="iDeviceTitle">Exercici 7.1 (Realtime Database)</h2><div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta152_152_2" class="block iDevice_content">
<p>Farem una aplicació per a agafar unes dades corresponents a unes estadístiques guardades en <strong>Realtime Database </strong> de <strong>Firebase</strong>, concretament en la següent aplicació:</p>
<ul>
<li>Compte de Google: <strong>ieselcaminas.ad@gmail.com </strong></li>
<li>Contrasenya: <strong>ad_ieselcaminas</strong></li>
<li>Aplicació: <strong>xat-ad</strong></li>
</ul>
<p>La informació a la qual volem accedir està en el array <strong>EstadisticaVariacioPoblacional</strong> amb les províncies, i en cada província tenim el nom (<strong>nombre</strong>) i en un array anomenat <strong>data</strong> tenim diferents anys amb el número d'any i el valor de la variació de la població:</p>
<p style="text-align: center;"><img src="T7_Ex1_1.png" alt="" width="749" height="444" /></p>
<p><strong>PODEU FER L'APLICACIÓ EN INTELLIJ O EN ANDROID</strong></p>
<p class="titolet">Aplicació en IntelliJ</p>
<p>Podeu utilitzar el "esquelet" que hi ha a continuació. En ell tenim:</p>
<ul>
<li>Un JCombobox per a triar la província</li>
<li>Un JTextArea, per a mostrar les dades de la província triada</li>
</ul>
<p>Haureu d'incorporar el fitxer json on està la configuració i la clau privada de la connexió. El fitxer s'anomena <strong>xat-ad-firebase-adminsdk-my2d0-8c69944b34.json</strong>, i el teniu com un recurs en l'aula virtual. La URL d'accés a aquesta Base de Dades és: <strong>https://xat-ad.firebaseio.com/</strong></p>
<p>L'aplicació ha de agafar les províncies (observeu que estan en una llista) i guardar-les en un JComboBox, per a poder trair-les. Quan es trie una província, s'haurà de mostrar en el JTextArea la informació corresponent a la província, agafant tots els anys de l'array <strong>Data</strong> (observeu que també és una llista) i mostrar l'any i el valor de la variació poblacional (respectivament <strong>NombrePeriodo</strong> i <strong>Valor</strong>)</p>
<p style="text-align: center;"><img src="T7Ex1_2.png" alt="" width="450" height="450" /></p>
<p>A continuació teniu l'esquelet del programa que podeu utilitzar, que el podeu guardar en el fitxer Kotlin <strong>T7Ex1_EstadisticaRD.kt</strong>:</p>
<div class="highlighted-code language-java" style="font-weight: bold;">
<div>
<div class="highlighted-code language-java">
<div>
<pre><code>import javax.swing.JFrame
import javax.swing.JLabel
import javax.swing.JComboBox
import javax.swing.JTextArea
import java.awt.BorderLayout
import javax.swing.JPanel
import java.awt.FlowLayout
import java.awt.Color
import javax.swing.JScrollPane
import java.io.FileInputStream
import com.google.firebase.FirebaseOptions
import com.google.auth.oauth2.GoogleCredentials
import com.google.firebase.FirebaseApp
import com.google.firebase.database.FirebaseDatabase
import com.google.firebase.database.DataSnapshot
import com.google.firebase.database.DatabaseError
import com.google.firebase.database.ChildEventListener
import java.awt.EventQueue


class EstadisticaRD : JFrame() {

	val etProv = JLabel("Provincia: ")
	val provincia = JComboBox&lt;String&gt;()

	val etiqueta = JLabel("Missatges:")
	val area = JTextArea()


	// en iniciar posem un contenidor per als elements anteriors
	init {
		defaultCloseOperation = JFrame.EXIT_ON_CLOSE
		setBounds(100, 100, 450, 450)
		setLayout(BorderLayout())
		// contenidor per als elements
		//Hi haurà títol. Panell de dalt: últim missatge. Panell de baix: per a introduir missatge. Panell central: tot el xat

		val panell1 = JPanel(FlowLayout())
		panell1.add(etProv)
		panell1.add(provincia)
		getContentPane().add(panell1, BorderLayout.NORTH)

		val panell2 = JPanel(BorderLayout())
		panell2.add(etiqueta, BorderLayout.NORTH)
		area.setForeground(Color.blue)
		area.setEditable(false)
		val scroll = JScrollPane(area)
		panell2.add(scroll, BorderLayout.CENTER)
		getContentPane().add(panell2, BorderLayout.CENTER)

		setVisible(true)

		val serviceAccount = FileInputStream("xat-ad-firebase-adminsdk-my2d0-8c69944b34.json")

		val options = FirebaseOptions.Builder()
			.setCredentials(GoogleCredentials.fromStream(serviceAccount))
			.setDatabaseUrl("https://xat-ad.firebaseio.com").build()

		FirebaseApp.initializeApp(options)

		// Posar tota la llista de províncies al JComboBox anomenat provincia


		provincia.addActionListener() {
			// Posar la informació de tots els anys en el JTextArea anomenat area

			
		}
	}
}

fun main(args: Array&lt;String&gt;) {
	EventQueue.invokeLater {
		EstadisticaRD().isVisible = true
	}
}</code></pre>
</div>
</div>
</div>
</div>
<p></p>
<p class="titolet">Aplicació en Android</p>
<ul>
<li>Creeu-vos una nova aplicació d'Android anomenada <strong>T7Ex1_EstadisticaRD</strong>.</li>
<li>Incorporeu en ella:
<ul>
<li>Un <strong>Spinner</strong> per a triar la província</li>
<li>Un <strong>TextView</strong>, per a mostrar les estadístiques de la província</li>
</ul>
</li>
<li>Connecteu a la Base de Dades Firebase abans esmentada</li>
</ul>
<p>L'aplicació ha de agafar les províncies (observeu que estan en una llista) i guardar-les en el Spinner, per a poder trair-les. Quan es trie una província, s'haurà de mostrar en el TextView la informació corresponent a la província, agafant tots els anys de l'array <strong>Data</strong> (observeu que també és una llista) i mostrar l'any i el valor de la variació poblacional (respectivament <strong>NombrePeriodo</strong> i <strong>Valor</strong>)</p>
<p>A continuació teniu un exemple de activity_main.xml que us podria servir:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #0000ff; font-weight: bold;">xml version</span><span style="color: #008000; font-weight: bold;">="1.0" </span><span style="color: #0000ff; font-weight: bold;">encoding</span><span style="color: #008000; font-weight: bold;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #000080; font-weight: bold;">androidx.constraintlayout.widget.ConstraintLayout </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">tools</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/tools"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="match_parent"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="match_parent"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">tools</span><span style="color: #0000ff; font-weight: bold;">:context</span><span style="color: #008000; font-weight: bold;">=".MainActivity"</span>&gt;<br /><br />    &lt;<span style="color: #000080; font-weight: bold;">Spinner<br /></span><span style="color: #000080; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:id</span><span style="color: #008000; font-weight: bold;">="@+id/combo"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="0dp"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="wrap_content"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintEnd_toEndOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintStart_toStartOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintTop_toTopOf</span><span style="color: #008000; font-weight: bold;">="parent" </span>/&gt;<br /><br />    &lt;<span style="color: #000080; font-weight: bold;">TextView<br /></span><span style="color: #000080; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:id</span><span style="color: #008000; font-weight: bold;">="@+id/area"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="0dp"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="0dp"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:scrollbars</span><span style="color: #008000; font-weight: bold;">="vertical"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:text</span><span style="color: #008000; font-weight: bold;">=""<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintBottom_toBottomOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintEnd_toEndOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintHorizontal_bias</span><span style="color: #008000; font-weight: bold;">="1.0"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintStart_toStartOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintTop_toBottomOf</span><span style="color: #008000; font-weight: bold;">="@+id/combo"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintVertical_bias</span><span style="color: #008000; font-weight: bold;">="0.0" </span>/&gt;<br /><br />&lt;/<span style="color: #000080; font-weight: bold;">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</pre>
<p>I a continuació l'esquelet del programa per si el voleu utilitzar ja que estan les recomacions-indicacions:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="color: #000080; font-weight: bold;">import </span>androidx.appcompat.app.AppCompatActivity<br /><span style="color: #000080; font-weight: bold;">import </span>android.os.Bundle<br /><span style="color: #000080; font-weight: bold;">import </span>android.util.Log<br /><span style="color: #000080; font-weight: bold;">import </span>android.view.View<br /><span style="color: #000080; font-weight: bold;">import </span>android.widget.AdapterView<br /><span style="color: #000080; font-weight: bold;">import </span>android.widget.ArrayAdapter<br /><span style="color: #000080; font-weight: bold;">import </span>androidx.core.view.size<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.*<br /><span style="color: #000080; font-weight: bold;">import </span>kotlinx.android.synthetic.main.activity_main.*<br /><br /><span style="color: #000080; font-weight: bold;">class </span>MainActivity : AppCompatActivity() {<br />    <span style="color: #000080; font-weight: bold;">override fun </span>onCreate(savedInstanceState: Bundle?) {<br />        <span style="color: #000080; font-weight: bold;">super</span>.onCreate(savedInstanceState)<br />        setContentView(R.layout.<span style="color: #660e7a; font-style: italic;">activity_main</span>)<br />        <span style="color: #000080; font-weight: bold;">val </span>pantPrincipal = <span style="color: #000080; font-weight: bold;">this  </span><span style="color: #808080; font-style: italic;">// per a utilitzar-lo en el ArrayAdapter del Spinner<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        // Inicialització de la referència i altres variables<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        // Lectura de totes les províncies per a posar-les després al Spinner<br /></span><span style="color: #808080; font-style: italic;">        // Es recomana llegir els fills de la llista, per tant addChildEventListener<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        // Inicialització del Spinner, amb un ArrayAdapter passant-li un ArrayList amb les províncies<br /></span><span style="color: #808080; font-style: italic;">        // es recomana fer-ho dins d'un addListenerForSingleValueEvent sobre la mateixa referència<br /></span><span style="color: #808080; font-style: italic;">        // per assegurar-nos que l'ArrayList ja té les províncies<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        // Instruccions per a posar en el TextView les dades de la provincia seleccionada<br /></span><span style="color: #808080; font-style: italic;">        // Dins del onItemSelectedListener del Spinner també es recomana llegir els fills de la llista,<br /></span><span style="color: #808080; font-style: italic;">        // per tant una altra vegada addChildEventListener<br /></span><span style="color: #808080; font-style: italic;">    </span>}<br />}</pre>
<p>Com posa en les indicacions, podem tenir la complicació de que quan construïm el Spinner, encara no estiguen les dades llegides. Ho podem solventar afegint un altre listener, el <strong>addListenerForSingleValueEvent</strong>, que segur que s'executarà després del <strong>addChildEventListener</strong></p>
<p></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper pblIdevice em_iDevice em_iDevice_activity" id="id240">
<div class="iDevice emphasis1" >
<img alt="" class="iDevice_icon" src="icon_activity.gif" /><h2 class="iDeviceTitle">Exercici 7.2 (Cloud Firestore)</h2><div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta240_229_2" class="block iDevice_content">
<div class="pbl-task-description"><p>Farem un exercici paregut a l'anterior, però ara les dades estaran guardades en <strong>Cloud Firestore.</strong></p>
<p>Es tractaran d'unes estadístiques lleugerament diferents de les anteriors, i sobretot, organitzades de forma diferent, més a l'estil de Cloud Firestore.</p>
<p>Les dades de connexió són les mateixes que en l'exercici anterior:</p>
<ul>
<li>Compte de Google: <strong>ieselcaminas.ad@gmail.com </strong></li>
<li>Contrasenya: <strong>ad_ieselcaminas</strong></li>
<li>Aplicació: <strong>xat-ad</strong></li>
</ul>
<p>Però ara ens connectem a Cloud Firestore, i tindrem totes les dades en la col·lecció <strong>Estadistica</strong>. Tindrem un document per cada província i any, amb la població de dones i homes. Per tant, com que hi ha 52 províncies i 10 anys d'estadístiques, tindrem un total de 520 documents.</p>
<p style="text-align: center;"><img src="T7Ex2_1.png" alt="" width="1259" height="693" /></p>
<p>Com es veu en la imatge, en cada document es guarda: la província, l'any, el número de dones i el número d'homes.</p>
<p><strong>PODEU FER L'APLICACIÓ EN INTELLIJ O EN ANDROID</strong></p>
<p class="titolet">Aplicació en IntelliJ</p>
<p>Podeu utilitzar el "esquelet" que hi ha a continuació. En ell tenim:</p>
<ul>
<li>Un JCombobox per a triar la província</li>
<li>Un JTextArea, per a mostrar les dades de la província triada</li>
</ul>
<p>Haureu d'incorporar el fitxer json on està la configuració i la clau privada de la connexió. El fitxer s'anomena <strong>xat-ad-firebase-adminsdk-my2d0-8c69944b34.json</strong>, i el teniu com un recurs en l'aula virtual. <strong></strong></p>
<ul>
<li>L'aplicació ha de agafar les províncies per a guardar-les en un JComboBox i poder triar-les, <strong>però tenint en compte que eixiran repetides</strong> (concretament 10 vegades cada província). Podeu afegir-les a un<strong> Mutable Set</strong> per a evitar que estiguen repetides, ja que un set es defineix com un conjunt no ordenat de valors que no es poden repetir. Així, si afegim un valor que ja estava, senzillament no el repetirà. Després només haureu d'ordenar aquest set.</li>
<li>Quan es trie una província, s'haurà de mostrar en el JTextArea la informació corresponent a la província, agafant tots els documents d'aquesta província, i millor ordenar-los per l'any. S'haurà de mostrar aquest any, i el número de dones i d'homes (respectivament <strong>any</strong> , <strong>Dones </strong>i <strong>Homes</strong>)</li>
</ul>
<p>Aquest seria l'aspecte:</p>
<p style="text-align: center;"><img src="T7Ex2_2.png" alt="" width="450" height="400" /></p>
<p style="text-align: left;">I aquest seria l'esquelet, que podeu guardar amb el nom <strong>T7Ex2_EstadisticaCF.kt</strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>import javax.swing.JFrame
import javax.swing.JLabel
import javax.swing.JComboBox
import javax.swing.JTextArea
import java.awt.BorderLayout
import java.awt.FlowLayout
import javax.swing.JPanel
import java.awt.Color
import javax.swing.JScrollPane
import java.io.FileInputStream
import com.google.firebase.FirebaseOptions
import com.google.auth.oauth2.GoogleCredentials
import com.google.firebase.FirebaseApp
import com.google.firebase.cloud.FirestoreClient
import java.awt.EventQueue

class EstadisticaCF : JFrame() {

	val etCombo = JLabel("Llista de províncies:")
	val comboProv = JComboBox&lt;String&gt;()

	val etiqueta = JLabel("Estadístiques:")
	val area = JTextArea()

	// en iniciar posem un contenidor per als elements anteriors
	init {
		defaultCloseOperation = JFrame.EXIT_ON_CLOSE
		setBounds(100, 100, 450, 400)
		setLayout(BorderLayout())
		// contenidor per als elements

		val panell1 = JPanel(FlowLayout())
		panell1.add(etCombo)
		panell1.add(comboProv)
		getContentPane().add(panell1, BorderLayout.NORTH)

		val panell2 = JPanel(BorderLayout())
		panell2.add(etiqueta, BorderLayout.NORTH)
		area.setForeground(Color.blue)
		area.setEditable(false)
		val scroll = JScrollPane(area)
		panell2.add(scroll, BorderLayout.CENTER)
		getContentPane().add(panell2, BorderLayout.CENTER)

		setVisible(true)

		val serviceAccount = FileInputStream("xat-ad-firebase-adminsdk-my2d0-8c69944b34.json")

		val options = FirebaseOptions.Builder()
			.setCredentials(GoogleCredentials.fromStream(serviceAccount))
			.build()

		FirebaseApp.initializeApp(options)

		val db = FirestoreClient.getFirestore()

		// Instruccions per a omplir el JComboBox amb les províncies

				
		// Instruccions per agafar la informació de tots els anys de la província triada
		comboProv.addActionListener() {<br />

	}
}

fun main(args: Array&lt;String&gt;) {
	EventQueue.invokeLater {
		EstadisticaCF().isVisible = true
	}
}</code></pre>
</div>
</div>
<p class="titolet">Aplicació en Android</p>
<ul>
<li>Creeu-vos una nova aplicació d'Android anomenada <strong>T7Ex2_EstadisticaCF</strong>.</li>
<li>Incorporeu en ella:
<ul>
<li>Un <strong>Spinner</strong> per a triar la província</li>
<li>Un <strong>TextView</strong>, per a mostrar les estadístiques de la província</li>
</ul>
</li>
<li>Connecteu a la Base de Dades Firebase abans esmentada</li>
<li>Incorporeu la següent  línia en el <strong>build-gradle</strong> de l'aplicació, per a que no us done error:<br />
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono', monospace; padding-left: 30px;"><span style="color: #067d17;"><strong>multiDexEnabled true</strong></span></pre>
</li>
</ul>
<p>L'aplicació ha de:</p>
<ul>
<li>Primer ha d'agafar les províncies per a guardar-les en el Spinner i poder triar-les, <strong>però tenint en compte que eixiran repetides</strong> (concretament 10 vegades cada província). Podeu afegir-les a un <strong>set</strong> per a evitar que estiguen repetides, ja que un set es defineix com un conjunt no ordenat de valors que no es poden repetir. Així, si afegim un valor que ja estava, senzillament no el repetirà. Després només haureu d'ordenar aquest set.</li>
<li>Quan es trie una província, s'haurà de mostrar en el TextView la informació corresponent a la província, agafant tots els documents d'aquesta província, i millor ordenar-los per l'any. S'haurà de mostrar aquest any, i el número de dones i d'homes (respectivament <strong>any</strong> , <strong>Dones </strong>i <strong>Homes</strong>)</li>
</ul>
<p>A continuació teniu un exemple de activity_main.xml que us podria servir:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #0000ff; font-weight: bold;">xml version</span><span style="color: #008000; font-weight: bold;">="1.0" </span><span style="color: #0000ff; font-weight: bold;">encoding</span><span style="color: #008000; font-weight: bold;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #000080; font-weight: bold;">androidx.constraintlayout.widget.ConstraintLayout </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">tools</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/tools"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="match_parent"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="match_parent"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">tools</span><span style="color: #0000ff; font-weight: bold;">:context</span><span style="color: #008000; font-weight: bold;">=".MainActivity"</span>&gt;<br /><br />    &lt;<span style="color: #000080; font-weight: bold;">Spinner<br /></span><span style="color: #000080; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:id</span><span style="color: #008000; font-weight: bold;">="@+id/combo"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="0dp"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="wrap_content"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintEnd_toEndOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintStart_toStartOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintTop_toTopOf</span><span style="color: #008000; font-weight: bold;">="parent" </span>/&gt;<br /><br />    &lt;<span style="color: #000080; font-weight: bold;">TextView<br /></span><span style="color: #000080; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:id</span><span style="color: #008000; font-weight: bold;">="@+id/area"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="0dp"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="0dp"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:scrollbars</span><span style="color: #008000; font-weight: bold;">="vertical"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:text</span><span style="color: #008000; font-weight: bold;">=""<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintBottom_toBottomOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintEnd_toEndOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintHorizontal_bias</span><span style="color: #008000; font-weight: bold;">="1.0"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintStart_toStartOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintTop_toBottomOf</span><span style="color: #008000; font-weight: bold;">="@+id/combo"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintVertical_bias</span><span style="color: #008000; font-weight: bold;">="0.0" </span>/&gt;<br /><br />&lt;/<span style="color: #000080; font-weight: bold;">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</pre>
<p>I aquest seria l'esquelet del programa principal amb els suggeriments:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><span style="color: #000080; font-weight: bold;">import </span>android.os.Bundle<br /><span style="color: #000080; font-weight: bold;">import </span>android.view.View<br /><span style="color: #000080; font-weight: bold;">import </span>android.widget.AdapterView<br /><span style="color: #000080; font-weight: bold;">import </span>android.widget.ArrayAdapter<br /><span style="color: #000080; font-weight: bold;">import </span>androidx.appcompat.app.AppCompatActivity<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.firestore.FirebaseFirestore<br /><span style="color: #000080; font-weight: bold;">import </span>kotlinx.android.synthetic.main.activity_main.*<br /><br /><br /><span style="color: #000080; font-weight: bold;">class </span>MainActivity : AppCompatActivity() {<br />    <span style="color: #000080; font-weight: bold;">override fun </span>onCreate(savedInstanceState: Bundle?) {<br />        <span style="color: #000080; font-weight: bold;">super</span>.onCreate(savedInstanceState)<br />        setContentView(R.layout.<span style="color: #660e7a; font-style: italic;">activity_main</span>)<br /><br />        <span style="color: #000080; font-weight: bold;">val </span>pantPrincipal = <span style="color: #000080; font-weight: bold;">this  </span><span style="color: #808080; font-style: italic;">// per a utilitzar-lo en el ArrayAdapter del spinner<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        // Inicialització de la referència i altres variables<br /></span><span style="color: #808080; font-style: italic;">        </span><span style="color: #000080; font-weight: bold;">val </span>db = FirebaseFirestore.getInstance()<br />        <span style="color: #000080; font-weight: bold;">val </span>colRef = db.collection(<span style="color: #008000; font-weight: bold;">"Estadistica"</span>)<br /><br />        <span style="color: #808080; font-style: italic;">// Lectura de totes les províncies per a posar-les després al Spinner<br /></span><span style="color: #808080; font-style: italic;">        // S'hauran de llegir tots els documents de la col·lecció, per tant addSnapshotListener<br /></span><span style="color: #808080; font-style: italic;">        // sobre la col·lecció<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        // Inicialització del Spinner, amb un ArrayAdapter passant-li un HashSet ordenat amb les províncies<br /></span><span style="color: #808080; font-style: italic;">        // es recomana fer-ho dins d'un addOnSuccessListener sobre la mateixa col·lecció<br /></span><span style="color: #808080; font-style: italic;">        // per assegurar-nos que el HashSet ja té les províncies<br /></span><span style="color: #808080; font-style: italic;"><br /></span><span style="color: #808080; font-style: italic;">        // Instruccions per a posar en el TextView les dades de la provincia seleccionada<br /></span><span style="color: #808080; font-style: italic;">        // Dins del onItemSelectedListener del Spinner també s'hauran de llegir els documents de la col·lecció<br /></span><span style="color: #808080; font-style: italic;">        // que són de la província triada, per tant una altra vegada addSnapshotListener<br /></span><span style="color: #808080; font-style: italic;">    </span>}<br />}</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper pblIdevice em_iDevice em_iDevice_activity" id="id259">
<div class="iDevice emphasis1" >
<img alt="" class="iDevice_icon" src="icon_activity.gif" /><h2 class="iDeviceTitle">Exercici 7.3 (Cloud Firestore - Cloud Storage) (voluntari)</h2><div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta259_259_2" class="block iDevice_content">
<div class="pbl-task-description"><p>Aquest exercici serà per a combinar guardar dades en Cloud Firestore amb fitxers guardats en Cloud Storage.</p>
<p>En compte de guardar imatges, ara guardarem <strong>audios</strong>. No podrem reproduir tots els tipus d'audio, però tots els audios que estiguen guardats es podran reproduir.</p>
<p>Les dades de connexió són les mateixes que en exercicis anteriors:</p>
<ul>
<li>Compte de Google: <strong>ieselcaminas.ad@gmail.com </strong></li>
<li>Contrasenya: <strong>ad_ieselcaminas</strong></li>
<li>Aplicació: <strong>xat-ad</strong></li>
</ul>
<p>L'estructura de dades és molt semblant a l'exemple en què guardàvem imatges</p>
<ul>
<li>En Cloud Firestore guardem en una col·lecció anomenada <strong>Audios</strong> una sèrie de documents, i en cadascun tindrem el nom de l'audio i el nom del fitxer</li>
<li>En Cloud Storage guardem els fitxer d'audio</li>
</ul>
<table style="width: 100%;" border="1">
<tbody>
<tr>
<td style="width: 50%;"><img src="T7_Ex4_1.png" alt="" width="549" height="343" /></td>
<td style="width: 50%;"><img src="T7_Ex4_2.png" alt="" width="585" height="319" /></td>
</tr>
</tbody>
</table>
<p>Podeu fer l'exercici tant en IntelliJ com en Android. En Android utilitzarem el component <strong>MediaPlayer</strong>. Aquest controlador també està disponible utilitzant les llibreries de <strong>JavaFX</strong>, però açò suposaria haver d'instal·lar plugins a IntelliJ, i no valdrà la pena. Utilitzarem un altre component que ja ve instal·lat, encara que limitat, ja que no en permetrà reproduir els fitxers .<strong>mp3</strong>, però sí els formats més senzills com <strong>.wav</strong> i <strong>.au</strong></p>
<p class="titolet">Aplicació en IntelliJ</p>
<p>El component que utilitzarem és <strong>AudioSystem</strong>, situada en <strong>javax.sound.sampled</strong>. Només l'hem d'inicialitzar un <strong>clip</strong> a partir de AudioSystem, i per una altra banda un AudioInputStream. Posteriorment obrirem el clip amb el AudioInputStream. Després només faltarà posar en marxa l'audio i parar-lo:</p>
<ul>
<li>Per a inicialitzar <strong>val audioInputStream = AudioSystem.getAudioInputStream(<em>InputStream</em>)</strong>  i <strong>val clip = AudioSystem.getClip()</strong><b>. </b>Haurem d'aconseguir l'InputStream bé a través del ByteBuffer o del fitxer temporal del nostre fitxer una vegada el tinguem baixat</li>
<li>Després obrirem el clip amb: <strong>clip.open(audioInputStream)</strong></li>
<li>Per a posar en marxa (play) <strong>clip.start()</strong></li>
<li>Per a parar (stop) <strong>clip.stop()</strong></li>
</ul>
<p>En definitiva, quedarà així:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>...
    val clip = AudioSystem.getClip()
...
            val audioInputStream = AudioSystem.getAudioInputStream(inputStream)

            clip.close()   // ha d'estar tancat abans de tornar a obrir-lo
            clip.open(audioInputStream)
...
            clip.stat()
...
            clip.stop()
...</code></pre>
</div>
</div>
<p>Us heu de muntar un <strong>JComboBox</strong> per a visualitzar la llista de audios, un botó per a posar en marxa l'audio seleccionat i un botó per a parar-lo</p>
<p style="text-align: center;"><img src="T7_Ex4_3.png" alt="" width="500" height="150" /></p>
<p style="text-align: justify;">Recordeu que amb el controlador utilitzat <strong>no</strong> es poden reproduir els fitxers <strong>mp3</strong>.</p>
<p class="titolet">Aplicació en Android</p>
<p>El component que utilitzarem és <strong>MediaPlayer</strong>. Només l'hem d'inicialitzar i després  posar en marxa l'audio i parar-lo:</p>
<ul>
<li>Per a inicialitzar<strong> val clip: MediaPlayer? = MediaPlayer.create(<em>context</em>,<em> fitxer de so</em>)</strong></li>
<li>Per a posar en marxa (play) <strong>clip.start()</strong></li>
<li>Per a parar (stop) <strong>clip.stop()</strong></li>
</ul>
<p>Si volem tornar a posar en marxa un audio que havíem parat el so, millor situar-lo a principi amb <strong>clip.seek(0)</strong></p>
<p>Us heu de muntar un <strong>Spinner</strong> per a visualitzar la llista de audios, un botó per a posar en marxa l'audio seleccionat i un botó per a parar-lo.</p>
<p>Potser en aquest cas <strong>no</strong> es puguen reproduir els fitxers <strong>.au</strong></p>
<p style="text-align: center;"></p></div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper activityIdevice em_iDevice em_iDevice_activity" id="id166">
<div class="iDevice emphasis1" >
<img alt="" class="iDevice_icon" src="icon_activity.gif" /><h2 class="iDeviceTitle">Exercici 7.4 (Realtime Database) (voluntari)</h2><div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta166_166_2" class="block iDevice_content">
<p>Farem una aplicació en <strong>IntelliJ</strong> i/o <strong>Android</strong> per a fer partides del Mastermind compartides. El joc consisteix a endevinar un número de 4 xifres no repetides. Quan es fa una tirada, l'aplicació contestarà quants xifres hi ha encertades i en el lloc corresponent, i quantes xifres encertades però fora del lloc.</p>
<p>Per exemple: Suposem que el número a endevinar és el 7481. A mida que anem fent tirades hem d'anar endevinant quin és el número:</p>
<ul>
<li>1234 <span style="color: #ff0000;">0 2</span> (que indica que no hi ha cap xifra al seu lloc, i que hi ha 2 encertades fora del lloc)</li>
<li>5678 <span style="color: #ff0000;">0 2</span></li>
<li>1256 <span style="color: #ff0000;">0 1</span></li>
<li>3487 <span style="color: #ff0000;">2 1<br /></span></li>
<li>7482 <span style="color: #ff0000;">3 0</span></li>
<li>7481 <span style="color: #ff0000;">4 0</span></li>
</ul>
<p>Els usuaris connectats a l'aplicació (amb un nom d'usuari, millor si és breu, per exemple 3 caràcters, a l'estil de J01, J02, ...) han de poder fer jugades, i l'aplicació ha de mostrar primer el nom del jugador, la tirada i el resultat.</p>
<p>Per més simplicitat, només es guardarà una partida, però quan finalitze s'ha de poder començar una altra (esborrant les tirades de la partida anterior). Les dades que guardarem de la partida són:</p>
<p><strong>Mastermind</strong> (serà la clau on ho guardarem tot)<strong> </strong></p>
<ul>
<li>Número secret a endevinar: <strong>numSecret</strong> (string)</li>
<li>Partida en marxa o bé ja finalitzada: <strong>finalitzada</strong> (boolean)</li>
<li>Llista de tirades: <strong>tirades</strong>. De cadascuna:
<ul>
<li>Jugador que l'ha feta: <strong>nom</strong> (string)</li>
<li>Jugada feta: <strong>tirada</strong> (string)</li>
<li>Encertades col·locades: <strong>colocades</strong> (integer)</li>
<li>Encertades no col·locades: <strong>desordenades</strong> (integer)</li>
</ul>
</li>
</ul>
<p>Tindrem els mateixos elements que en l'exemple del xat:</p>
<ul>
<li>Una etiqueta per a indicar nom de jugador</li>
<li>Un JTextField o EditText per a introduir el nom del jugador. Aquestes dues coses han d'anar dalt de tot, en la mateixa línia.</li>
<li>Un JTextArea o TextView, per a anar mostrant les tirades de la partida</li>
<li>Un altre JTextField o EditText per a introduir la nova tirada.</li>
<li>Un botó d'Enviar. Aquestes dues coses han d'anar baix de tot, en la mateixa línia.</li>
<li>Per últim també tindrem un botó que inicialment està ocult per a començar una nova partida. Quan es visualitza tapa el JTextField o EditText de la nova tirada i el botó d'enviar, amb la qual cosa no es poden fer més intents</li>
</ul>
<p>Inicialment s'ha de comprovar si la partida està en marxa. Si no ho està (o si no hi ha cap partida perquè és la primera vegada que s'executa):</p>
<ul>
<li>S'ha de generar un nou número secret i guardar-lo</li>
<li>S'ha de marcar com a partida no finalitzada</li>
</ul>
<p>Si ja està en marxa, senzillament s'ha d'agafar el número secret i s'han de visualitzar les tirades existents, i esperar per si es fa una tirada.</p>
<p>Quan es fa una tirada:</p>
<ul>
<li>S'ha de guardar el jugador, la tirada, el número de encertades col·locades i el número d'encertades no col·locades.</li>
<li>Si s'ha encertat el número, s'ha de marcar com a finalitzada la partida, i s'ha de visualitzar el botó per a generar una nova partida</li>
</ul>
<p>Les dades de connexió són les mateixes que l'exercici anterior:</p>
<ul>
<li>Compte de Google: <strong>ieselcaminas.ad@gmail.com </strong></li>
<li>Contrasenya: <strong>ad_ieselcaminas</strong></li>
<li>Aplicació: <strong>xat-ad</strong></li>
</ul>
<p>Us passe els mètodes <strong>genera()</strong>, que genera un número aleatori de 4 xifres no repetides, i <strong>comprova(String,String)</strong> que torna les xifres encertades col·locades i encertades no col·locades:<span style="color: #000080; font-weight: bold;"></span></p>
<div class="highlighted-code language-java">
<div>
<pre><code>	fun genera(): String {
		val i0 = (Math.random() * 10).toInt()
		var i1 = (Math.random() * 10).toInt()
		while (i1 == i0)
			i1 = (Math.random() * 10).toInt()
		var i2 = (Math.random() * 10).toInt()
		while (i2 == i0 || i2 == i1)
			i2 = (Math.random() * 10).toInt()
		var i3 = (Math.random() * 10).toInt()
		while (i3 == i0 || i3 == i1 || i3 == i2)
			i3 = (Math.random() * 10).toInt()
		return (i0.toString() + i1.toString() + i2.toString() + i3.toString())
	}

	fun comprova(num: String, sec: String): IntArray {
		var pos = 0
		var nopos = 0
		for (i in 0..3)
			for (j in 0..3)
				if (num[i] == sec[j])
					if (i == j) pos++
					else nopos++
		return intArrayOf(pos, nopos)
	}</code></pre>
</div>
</div>
<p class="titolet">Aplicació en IntelliJ</p>
<p>L'aplicació s'ha de guardar en el fitxer <strong>T7Ex4_Mastermind_RD.kt</strong>, i aquest seria l'esquelet:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>package exercicis

import com.google.auth.oauth2.GoogleCredentials
import com.google.firebase.FirebaseApp
import com.google.firebase.FirebaseOptions
import com.google.firebase.database.*
import java.awt.*
import java.io.FileInputStream
import javax.swing.*

class Tirada(var nom: String, var tirada: String, var colocades: Int, var desordenades: Int)

class T7Ex4_Mastermind_RD : JFrame() {

    val etJugador = JLabel("Nom Jugador: ")
    val jugador = JTextField(15)

    val etiqueta = JLabel("Tirades:")
    val area = JTextArea()

    val etIntroduccioTirada = JLabel("Introdueix tirada:")
    val enviar = JButton("Enviar")
    val tirada = JTextField(15)

    val botoPartidaNova = JButton("PARTIDA NOVA")

    var numSecret = ""

    // en iniciar posem un contenidor per als elements anteriors
    init {
        defaultCloseOperation = JFrame.EXIT_ON_CLOSE
        setBounds(100, 100, 450, 300)
        setLayout(BorderLayout())

        // contenidor per als elements
        //Hi haurà títol. Panell de dalt: últim missatge. Panell de baix: per a introduir missatge. Panell central: tot el xat

        val panell1 = JPanel(FlowLayout())
        panell1.add(etJugador)
        panell1.add(jugador)
        getContentPane().add(panell1, BorderLayout.NORTH)

        val panell2 = JPanel(BorderLayout())
        panell2.add(etiqueta, BorderLayout.NORTH)
        area.setForeground(Color.BLUE)
        area.isEditable=false
        val scroll = JScrollPane(area)
        panell2.add(scroll, BorderLayout.CENTER)
        getContentPane().add(panell2, BorderLayout.CENTER)

        val panell3 = JPanel(FlowLayout())
        panell3.add(etIntroduccioTirada)
        panell3.add(tirada)
        panell3.add(enviar)
        getContentPane().add(panell3, BorderLayout.SOUTH)
        botoPartidaNova.isVisible=false
        panell3.add(botoPartidaNova)

        setVisible(true)
        enviar.addActionListener { enviar() }

        botoPartidaNova.addActionListener { partidaNova() }

        val serviceAccount = FileInputStream("xat-ad-firebase-adminsdk-my2d0-8c69944b34.json")

        val options = FirebaseOptions.builder()
            .setCredentials(GoogleCredentials.fromStream(serviceAccount))
            .setDatabaseUrl("https://xat-ad.firebaseio.com/").build()

        FirebaseApp.initializeApp(options)

        title="MASTERMIND"

        // Exemple de listener de lectura única addListenerForSingleValue()
        // Per a AGAFAR SI ESTÀ LA PARTIDA EN MARXA I EL NÚMERO SECRET
        val mastermind = FirebaseDatabase.getInstance().getReference("Mastermind")

        mastermind.addListenerForSingleValueEvent(object : ValueEventListener {
            override
            fun onDataChange(dataSnapshot: DataSnapshot) {
                println("Entrem")
                if (dataSnapshot.child("finalitzada").getValue(Boolean::class.java)){
                    //partidaNova()
                    println("Patida nova")
                }
                else {
                    numSecret = dataSnapshot.child("numSecret").getValue(String::class.java)
                }
            }

            override
            fun onCancelled(error: DatabaseError) {
            }
        })


    }

    fun partidaNova(){

    }


    fun enviar(){

     }

    fun genera(): String {
        val i0 = (Math.random() * 10).toInt()
        var i1 = (Math.random() * 10).toInt()
        while (i1 == i0)
            i1 = (Math.random() * 10).toInt()
        var i2 = (Math.random() * 10).toInt()
        while (i2 == i0 || i2 == i1)
            i2 = (Math.random() * 10).toInt()
        var i3 = (Math.random() * 10).toInt()
        while (i3 == i0 || i3 == i1 || i3 == i2)
            i3 = (Math.random() * 10).toInt()
        return (i0.toString() + i1.toString() + i2.toString() + i3.toString())
    }

    fun comprova(num: String, sec: String): IntArray {
        var pos = 0
        var nopos = 0
        for (i in 0..3)
            for (j in 0..3)
                if (num[i] == sec[j])
                    if (i == j) pos++
                    else nopos++
        return intArrayOf(pos, nopos)
    }

}



fun main(args: Array&lt;String&gt;) {
    EventQueue.invokeLater {
        T7Ex4_Mastermind_RD().isVisible = true
    }
}</code></pre>
</div>
</div>
<p></p>
<p class="titolet">Aplicació en Android</p>
<p>Crea un projecte anomenat <strong>T7Ex4_Mastermind_RD</strong></p>
<p>Aquest seria el <strong>activity_main.xml</strong> amb els elements comentats abans:</p>
<pre style="background-color: #ffffff; color: #080808; font-family: 'DejaVu Sans Mono',monospace; font-size: 9,0pt;"><strong><span style="font-style: italic;">&lt;?</span><span style="color: #174ad4;">xml version</span><span style="color: #067d17;">="1.0" </span><span style="color: #174ad4;">encoding</span><span style="color: #067d17;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #0033b3;">RelativeLayout </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">android</span><span style="color: #067d17;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #067d17;">    </span><span style="color: #174ad4;">xmlns:</span><span style="color: #871094;">tools</span><span style="color: #067d17;">="http://schemas.android.com/tools"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/activity_main"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">    </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="match_parent"</span>&gt;</strong><br /><br /><strong>    &lt;<span style="color: #0033b3;">TextView<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="Nom del jugador (preferiblement 3 caràcters):"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/eti"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentTop</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentLeft</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentStart</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_above</span><span style="color: #067d17;">="@+id/textView" </span>/&gt;</strong><br /><strong>    &lt;<span style="color: #0033b3;">EditText<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/jugador"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentRight</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_toRightOf</span><span style="color: #067d17;">="@+id/eti"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentTop</span><span style="color: #067d17;">="true" </span>/&gt;</strong><br /><br /><strong>    &lt;<span style="color: #0033b3;">TextView<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/textView"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="match_parent"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_above</span><span style="color: #067d17;">="@+id/tirada"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_below</span><span style="color: #067d17;">="@+id/jugador"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentEnd</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentRight</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:scrollbars</span><span style="color: #067d17;">="vertical"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="" </span>/&gt;</strong><br /><strong>    &lt;<span style="color: #0033b3;">EditText<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/tirada"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentLeft</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentStart</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentBottom</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_toLeftOf</span><span style="color: #067d17;">="@+id/boto"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_toStartOf</span><span style="color: #067d17;">="@+id/boto" </span>/&gt;</strong><br /><br /><strong>    &lt;<span style="color: #0033b3;">Button<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="Enviar"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/boto"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentRight</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentEnd</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentBottom</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_below</span><span style="color: #067d17;">="@+id/textView" </span>/&gt;</strong><br /><strong>    &lt;<span style="color: #0033b3;">Button<br /></span><span style="color: #0033b3;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_width</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_height</span><span style="color: #067d17;">="wrap_content"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:text</span><span style="color: #067d17;">="NOVA PARTIDA"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:id</span><span style="color: #067d17;">="@+id/botoNova"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentRight</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentEnd</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentBottom</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_below</span><span style="color: #067d17;">="@+id/textView"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentLeft</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:layout_alignParentStart</span><span style="color: #067d17;">="true"<br /></span><span style="color: #067d17;">        </span><span style="color: #871094;">android</span><span style="color: #174ad4;">:visibility</span><span style="color: #067d17;">="invisible"</span>/&gt;</strong><br /><br /><strong>&lt;/<span style="color: #0033b3;">RelativeLayout</span>&gt;</strong></pre>
<p></p>
</div>
</div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="534_csandroid_exemple_ampliat_combinant_amb_cloud_firestore.html" class="prev"><span><span>&laquo; </span>Anterior</span></a>
</div>
</div>
</div>
</div>
</div>
</body></html>