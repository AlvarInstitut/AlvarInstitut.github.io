<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>5.2.4 CS-IntelliJ: Exemple ampliat, combinant amb Cloud Firestore | Bases de Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-76"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Bases de Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 7: FIREBASE</a></li>
   <li><a href="1__introducci_firebase.html" class="no-ch">1 - Introducció: Firebase</a></li>
   <li><a href="2__creaci_duna_aplicaci.html" class="no-ch">2 - Creació d'una aplicació</a></li>
   <li><a href="3__realtime_database_rd.html" class="daddy">3 - Realtime Database (RD)</a>
   <ul class="other-section">
      <li><a href="31_rd_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">3.1 RD: Utilització des de l'entorn de Firebase</a></li>
      <li><a href="32_rd_utilitzaci_des_de_intellij.html" class="daddy">3.2 RD: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="321_rdintellij_connexi_des_de_kotlin.html" class="no-ch">3.2.1 RD-IntelliJ: Connexió des de Kotlin</a></li>
         <li><a href="322_rdintellij_accs_a_les_dades.html" class="no-ch">3.2.2 RD-IntelliJ: Accés a les dades</a></li>
         <li><a href="323_rdintellij_tot_lexemple.html" class="no-ch">3.2.3 RD-IntelliJ: Tot l'exemple</a></li>
      </ul>
      </li>
      <li><a href="33_rd_utilitzaci_des_dandroid.html" class="daddy">3.3 RD: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="331_rdandroid_connexi_des_dandroid.html" class="no-ch">3.3.1 RD-Android: Connexió des d'Android</a></li>
         <li><a href="332_rdandroid_accs_a_les_dades.html" class="no-ch">3.3.2 RD-Android: Accés a les dades</a></li>
         <li><a href="333_rdandroid_tot_lexemple.html" class="no-ch">3.3.3 RD-Android: Tot l'exemple</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="4__cloud_firestore_cf.html" class="daddy">4 - Cloud Firestore (CF)</a>
   <ul class="other-section">
      <li><a href="41_cf_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">4.1 CF: Utilització des de l'entorn de Firebase</a></li>
      <li><a href="42_cf_utilitzaci_des_de_intellij.html" class="daddy">4.2 CF: Utilització des de IntelliJ</a>
      <ul class="other-section">
         <li><a href="421_cfintellij_connexi_des_de_kotlin.html" class="no-ch">4.2.1 CF-IntelliJ: Connexió des de Kotlin</a></li>
         <li><a href="422_cfintellij_accs_a_les_dades.html" class="no-ch">4.2.2 CF-IntelliJ: Accés a les dades</a></li>
         <li><a href="423_cfintellij_tot_lexemple.html" class="no-ch">4.2.3 CF-IntelliJ: Tot l'exemple</a></li>
         <li><a href="424_cfintellij_exemple_ampliat.html" class="no-ch">4.2.4 CF-IntelliJ: Exemple ampliat</a></li>
      </ul>
      </li>
      <li><a href="43_cf_utilitzaci_des_dandroid.html" class="daddy">4.3 CF: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="431_cfandroid_connexi.html" class="no-ch">4.3.1 CF-Android: Connexió</a></li>
         <li><a href="432_cfandroid_accs_a_les_dades.html" class="no-ch">4.3.2 CF-Android: Accés a les dades</a></li>
         <li><a href="433_cfandroid_tot_lexemple.html" class="no-ch">4.3.3 CF-Android: Tot l'exemple</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="5__cloud_storage.html" class="current-page-parent daddy">5 - Cloud Storage</a>
   <ul>
      <li><a href="51_cs_utilitzaci_des_de_lentorn.html" class="no-ch">5.1 CS: Utilització des de l'entorn</a></li>
      <li class="current-page-parent"><a href="52_cs_utilitzaci_des_de_intellij.html" class="current-page-parent daddy">5.2 CS: Utilització des de IntelliJ</a>
      <ul>
         <li><a href="521_csintellij_connexi.html" class="no-ch">5.2.1 CS-IntelliJ: Connexió</a></li>
         <li><a href="522_csintellij_accs_a_les_dades.html" class="no-ch">5.2.2 CS-IntelliJ: Accés a les dades</a></li>
         <li><a href="523_csintellij_tot_lexemple.html" class="no-ch">5.2.3 CS-IntelliJ: Tot l'exemple</a></li>
         <li id="active"><a href="524_csintellij_exemple_ampliat_combinant_amb_cloud_firestore.html" class="active no-ch">5.2.4 CS-IntelliJ: Exemple ampliat, combinant amb Cloud Firestore</a></li>
      </ul>
      </li>
      <li><a href="53_cs_utilitzaci_des_dandroid.html" class="daddy">5.3 CS: Utilització des d'Android</a>
      <ul class="other-section">
         <li><a href="531_csandroid_connexi.html" class="no-ch">5.3.1 CS-Android: Connexió</a></li>
         <li><a href="532_csandroid_accs_als_fitxers.html" class="no-ch">5.3.2 CS-Android: Accés als fitxers</a></li>
         <li><a href="533_csandroid_tot_lexemple.html" class="no-ch">5.3.3 CS-Android: Tot l'exemple</a></li>
         <li><a href="534_csandroid_exemple_ampliat_combinant_amb_cloud_firestore.html" class="no-ch">5.3.4 CS-Android: Exemple ampliat, combinant amb Cloud Firestore</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="523_csintellij_tot_lexemple.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="53_cs_utilitzaci_des_dandroid.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">5.2.4 CS-IntelliJ: Exemple ampliat, combinant amb Cloud Firestore</h1></div>
<div class="iDevice_wrapper textIdevice" id="id248">
<div class="iDevice emphasis0" >
<div id="ta248_248_2" class="block iDevice_content">
<div class="exe-text"><p>Anem a fer un altre exemple, que serà el de CoffeeShops_Fragments, ja fet en el mòdul DI, i retocat en l'Annex d'Android, al qual vam incorporar una Base de Dades SQLite amb les dades (inclosa la imatge del cafè), i a la qual accedíem a través de la llibreria ROOM.</p>
<p>Des d'<strong>IntelliJ</strong> només ens plantegem accedir a Cloud Firestore i Cloud Storage per a agafar:</p>
<ul>
<li>De Cloud Firestore els documents de la col·lecció on està entre altres coses el nom de la imatge</li>
<li>Amb aquest nom d'imatge anirem a Cloud Storage per a agafar-la</li>
</ul>
<p>D'aquesta manera ens queda una pantalla molt senzilla, pràcticament com en l'exemple anterior, és a dir amb un <strong>JComboBox</strong> amb el nom de les imatges, que ara agafarem de Cloud Firestore, i un <strong>JButton </strong> per a mostrar la imatge.</p>
<p>Li posarem ara el nom de <strong>Exemple_7_5_3_FirebaseCF-CS_CoffeeShops</strong><strong>.kt</strong>. El codi està simplificat al màxim, llevant tractament d'errors i opcions. Observeu que estem connectant a l'usuari comú que tenim per a fer proves, <strong>ieselcaminas.ad@gmail.com</strong></p>
<div class="highlighted-code language-java">
<div>
<pre><code>import javax.swing.JFrame
import java.awt.EventQueue
import javax.swing.JComboBox
import javax.swing.JLabel
import java.awt.BorderLayout
import javax.swing.JPanel
import java.awt.FlowLayout
import java.io.FileInputStream
import com.google.firebase.FirebaseOptions
import com.google.auth.oauth2.GoogleCredentials
import com.google.firebase.FirebaseApp
import com.google.cloud.storage.Bucket
import com.google.firebase.cloud.StorageClient
import java.nio.file.Paths
import java.awt.image.BufferedImage
import javax.imageio.ImageIO
import java.io.IOException
import java.nio.ByteBuffer
import java.io.ByteArrayInputStream
import javax.swing.ImageIcon
import java.io.File
import javax.swing.JButton
import com.google.firebase.cloud.FirestoreClient
import com.google.cloud.firestore.DocumentChange
import com.google.cloud.firestore.Firestore

class CoffeeShops : JFrame() {
    val nomCafe = JComboBox&lt;String&gt;()
    val foto = JButton()

    var bucket: Bucket? = null
    var database: Firestore? = null

    init {
        defaultCloseOperation = JFrame.EXIT_ON_CLOSE
        setBounds(100, 100, 900, 600)
        setLayout(BorderLayout())

        val panell1 = JPanel(FlowLayout())
        panell1.add(nomCafe)
        getContentPane().add(panell1, BorderLayout.NORTH)

        getContentPane().add(foto, BorderLayout.CENTER)

        val serviceAccount = FileInputStream("xat-ad-firebase-adminsdk-my2d0-8c69944b34.json")

        val options = FirebaseOptions.builder()
            .setCredentials(GoogleCredentials.fromStream(serviceAccount))
            .build()

        FirebaseApp.initializeApp(options)

        database = FirestoreClient.getFirestore()
        bucket = StorageClient.getInstance().bucket("xat-ad.appspot.com")

        // Exemple de listener de lectura contínua addSnapshotListener() sobre una col·lecció
        // Per a posar tota la llista de missatges. Sobre /Xats/XatProva/missatges

        database?.collection("CoffeeShops")?.orderBy("nom")?.addSnapshotListener { snapshots, e -&gt;
            for (dc in snapshots!!.getDocumentChanges()) {
                nomCafe.addItem(dc.getDocument().getString("nom"))
            }
        }

        nomCafe.addActionListener { agafar() }

    }

    fun agafar() {
        //Primer agafem el nom de la imatge mirant el document que té el nom com el triat
        //Després agafem la imatge amb eixe nom
        database?.collection("CoffeeShops")?.whereEqualTo("nom", nomCafe.getSelectedItem())!!
            .addSnapshotListener { snapshots, e -&gt;

                for (dc in snapshots!!.getDocumentChanges()) {
                    val blob = bucket?.get("CoffeeShops/" + dc.getDocument().getString("imatge"))

                    //Segona manera de llegir: muntant un reader per a carregar a un ByteBuffer
                    val im = ByteBuffer.allocate(1024 * 1024)
                    blob?.reader()?.read(im)
                    val image = ImageIO.read(ByteArrayInputStream(im.array()))
                    foto.setIcon(ImageIcon(image))
                }
            }
    }

}

fun main(args: Array&lt;String&gt;) {
    EventQueue.invokeLater {
        CoffeeShops().isVisible = true
    }
}</code></pre>
</div>
</div>
<p></p></div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="523_csintellij_tot_lexemple.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="53_cs_utilitzaci_des_dandroid.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
</div>
</div>
</div>
</body></html>