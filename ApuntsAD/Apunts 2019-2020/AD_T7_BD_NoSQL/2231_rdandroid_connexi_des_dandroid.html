<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>2.2.3.1 RD-Android: Connexió des d'Android | Bases de Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-40"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Bases de Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 7: Bases de Dades NoSQL</a></li>
   <li><a href="1__introducci.html" class="no-ch">1 - Introducció</a></li>
   <li class="current-page-parent"><a href="2__firebase.html" class="current-page-parent daddy">2 - Firebase</a>
   <ul>
      <li><a href="21_creaci_duna_aplicaci.html" class="no-ch">2.1 Creació d'una aplicació</a></li>
      <li class="current-page-parent"><a href="22_realtime_database_rd.html" class="current-page-parent daddy">2.2 Realtime Database (RD)</a>
      <ul>
         <li><a href="221_rd_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">2.2.1 RD: Utilització des de l'entorn de Firebase</a></li>
         <li><a href="222_rd_utilitzaci_des_de_java.html" class="daddy">2.2.2 RD: Utilització des de Java</a>
         <ul class="other-section">
            <li><a href="2221_rdjava_connexi_des_de_java.html" class="no-ch">2.2.2.1 RD-Java: Connexió des de Java</a></li>
            <li><a href="2222_rdjava_accs_a_les_dades.html" class="no-ch">2.2.2.2 RD-Java: Accés a les dades</a></li>
            <li><a href="2223_rdjava_tot_lexemple.html" class="no-ch">2.2.2.3 RD-Java: Tot l'exemple</a></li>
         </ul>
         </li>
         <li class="current-page-parent"><a href="223_rd_utilitzaci_des_dandroid.html" class="current-page-parent daddy">2.2.3 RD: Utilització des d'Android</a>
         <ul>
            <li id="active"><a href="2231_rdandroid_connexi_des_dandroid.html" class="active no-ch">2.2.3.1 RD-Android: Connexió des d'Android</a></li>
            <li><a href="2232_rdandroid_accs_a_les_dades.html" class="no-ch">2.2.3.2 RD-Android: Accés a les dades</a></li>
            <li><a href="2233_rdandroid_tot_lexemple.html" class="no-ch">2.2.3.3 RD-Android: Tot l'exemple</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="23_cloud_firestore_cf.html" class="daddy">2.3 Cloud Firestore (CF)</a>
      <ul class="other-section">
         <li><a href="231_cf_utilitzaci_des_de_lentorn_de_firebase.html" class="no-ch">2.3.1 CF: Utilització des de l'entorn de Firebase</a></li>
         <li><a href="232_cf_utilitzaci_des_de_java.html" class="daddy">2.3.2 CF: Utilització des de Java</a>
         <ul class="other-section">
            <li><a href="2321_cfjava_connexi_des_de_java.html" class="no-ch">2.3.2.1 CF-Java: Connexió des de Java</a></li>
            <li><a href="2322_cfjava_accs_a_les_dades.html" class="no-ch">2.3.2.2 CF-Java: Accés a les dades</a></li>
            <li><a href="2323_cfjava_tot_lexemple.html" class="no-ch">2.3.2.3 CF-Java: Tot l'exemple</a></li>
         </ul>
         </li>
         <li><a href="233_cf_utilitzaci_des_dandroid.html" class="daddy">2.3.3 CF: Utilització des d'Android</a>
         <ul class="other-section">
            <li><a href="2331_cfandroid_connexi.html" class="no-ch">2.3.3.1 CF-Android: Connexió</a></li>
            <li><a href="2332_cfandroid_accs_a_les_dades.html" class="no-ch">2.3.3.2 CF-Android: Accés a les dades</a></li>
            <li><a href="2333_cfandroid_tot_lexemple.html" class="no-ch">2.3.3.3 CF-Android: Tot l'exemple</a></li>
         </ul>
         </li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="3__bases_de_dades_clauvalor.html" class="daddy">3 - Bases de Dades Clau-Valor</a>
   <ul class="other-section">
      <li><a href="31__installaci_de_redis.html" class="no-ch">3.1 - Instal·lació de Redis</a></li>
      <li><a href="32__utilitzaci_de_redis.html" class="daddy">3.2 - Utilització de Redis</a>
      <ul class="other-section">
         <li><a href="321__strings.html" class="no-ch">3.2.1 - Strings</a></li>
         <li><a href="322__keys.html" class="no-ch">3.2.2 - Keys</a></li>
         <li><a href="323__hash.html" class="no-ch">3.2.3 - Hash</a></li>
         <li><a href="324__list.html" class="no-ch">3.2.4 - List</a></li>
         <li><a href="325__set.html" class="no-ch">3.2.5 - Set</a></li>
         <li><a href="326__set_ordenat.html" class="no-ch">3.2.6 - Set ordenat</a></li>
      </ul>
      </li>
      <li><a href="33__connexi_des_de_java.html" class="no-ch">3.3 - Connexió des de Java</a></li>
   </ul>
   </li>
   <li><a href="4__mongodb.html" class="daddy">4 - MongoDB</a>
   <ul class="other-section">
      <li><a href="41__installaci_de_mongodb.html" class="no-ch">4.1 - Instal·lació de MongoDB</a></li>
      <li><a href="42__utilitzaci_de_mongodb.html" class="daddy">4.2 - Utilització de MongoDB</a>
      <ul class="other-section">
         <li><a href="421__tipus_de_dades.html" class="no-ch">4.2.1 - Tipus de dades</a></li>
         <li><a href="422__operacions_bsiques.html" class="no-ch">4.2.2 - Operacions bàsiques</a></li>
         <li><a href="423__operacions_dactualitzaci_avanada.html" class="daddy">4.2.3 - Operacions d'actualització avançada</a>
         <ul class="other-section">
            <li><a href="4231__set.html" class="no-ch">4.2.3.1 - $set</a></li>
            <li><a href="4232__unset.html" class="no-ch">4.2.3.2 - $unset</a></li>
            <li><a href="4233__rename.html" class="no-ch">4.2.3.3 - $rename</a></li>
            <li><a href="4234__inc.html" class="no-ch">4.2.3.4 - $inc</a></li>
            <li><a href="4235__elements_dun_array.html" class="no-ch">4.2.3.5 - Elements d'un array</a></li>
            <li><a href="4236__inserci_en_arrays_push.html" class="no-ch">4.2.3.6 - Inserció en Arrays: $push</a></li>
            <li><a href="4237__eliminaci_en_arrays_pop_i_pull.html" class="no-ch">4.2.3.7 - Eliminació en arrays: $pop i $pull</a></li>
            <li><a href="4238__upsert.html" class="no-ch">4.2.3.8 - Upsert</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="43__consulta_de_documents.html" class="daddy">4.3 - Consulta de documents</a>
      <ul class="other-section">
         <li><a href="431__parmetres_de_les_funcions_find_i_findone.html" class="no-ch">4.3.1 - Paràmetres de les funcions find() i findOne()</a></li>
         <li><a href="432__operadors_de_les_condicions.html" class="no-ch">4.3.2 - Operadors de les condicions</a></li>
         <li><a href="433__agregaci.html" class="no-ch">4.3.3 - Agregació</a></li>
      </ul>
      </li>
      <li><a href="44__connexi_des_de_java.html" class="no-ch">4.4 - Connexió des de Java</a></li>
   </ul>
   </li>
   <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="223_rd_utilitzaci_des_dandroid.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="2232_rdandroid_accs_a_les_dades.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">2.2.3.1 RD-Android: Connexió des d'Android</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id155">
<div class="iDevice emphasis0">
<div id="ta155_85" class="block iDevice_content">
<p>L'accés és extraordinàriament fàcil gràcies als assistents que ens proporciona el propi Android Studio.</p>
<p>Per a poder provar-lo ens crearem un projecte d'Android anomenat per exemple <strong>Tema7_1_FirebaseRD_Java</strong> i/o <strong>Tema7_1_FirebaseRD_Kotlin</strong></p>
<p>Al final de tot teniu un vídeo que repassa tots els passos per a poder connectar des de la nostra aplicació d'Android. A continuació els repassem i expliquem un a un. Són els que ens marca l'assistent, que haurem d'invocar sobre el nostre projecte ja creat, i que es crida des de  <strong>Tools --&gt; Firebase --&gt; Realtime Database</strong> :</p>
<p>Observeu que quasi quasi tot és idèntic, encara que utilitzem Java o Kotlin. Només farem la diferenciació en l'exemple, on estarà ja tot el codi.</p>
<p class="titolet">Connectar l'aplicació a Firebase</p>
<p style="text-align: center;"><img src="T7_2_2_3_1_1.png" alt="" width="1115" height="697" /></p>
<p>En apretar el botó de<strong> Connect to Firebase</strong>, si no estàvem connectats amb el compte de Google al Firebase se'ns obrirà finestra d'un navegador per a connectar. Podria donar-se el cas que ens diguera que Android Studio vol accedir a les dades de la Base de Dades. Òbviament ho haurem de permetre:</p>
<p style="text-align: center;"><img src="T7_2_2_3_1_2.png" alt="" width="402" height="725" /></p>
<p>Una vegada autenticats en Firebase, des de l'entorn d'Android Studio ens ofereix la possibilitat de crear una aplicació nova (una Base de Dades nova) o utilitzar alguna de les que ja tenim. Utilitzarem la que ens ha servit de prova fins el moment:</p>
<p style="text-align: center;"><img src="T7_2_2_3_1_3.png" alt="" width="679" height="453" /></p>
<p>Quan haja connectat substituirà el botó <strong>Connect to Firebase</strong>, per una etiqueta que dirà <strong>connected</strong>, en verd.</p>
<p class="titolet">Afegir la Base de Dades a la nostra aplicació</p>
<p>En aquest segon pas, quan apretem el botó <strong>Add the Realtime Database in your app</strong>, ens dirà els canvis que farà per a incorporar les coses necessàries per a poder connectar.</p>
<p style="text-align: center;"><img src="T7_2_2_3_1_4.png" alt="" width="642" height="450" /></p>
<p>Com veieu es tracta d'incorporar les llibreries necessàries de Firebase. En el vídeo del final es mostren imatges amb les dades incorporades.</p>
<p>Igual que abans, substituirà el botó <strong>Add the Realtime Database in your app</strong>, per una etiqueta que dirà <strong>Dependencies set up correctly</strong>, en verd. És una bona guia per saber en quin punt estem.</p>
<p class="titolet">Permetre l'accés als usuaris, si es precís canviant les regles d'accés a la Base de Dades</p>
<p>En versions anteriors de Firebase, per defecte les Bases de Dades (aplicacions) de Firebase estaven configurades per a que es connecten únicament usuaris autenticats. Això serà molt convenient en el futur, quan des del mòdul PMDM proveu l'autenticació d'usuaris. Però en l'última versió ens pregunta quan fem el primer accés si volem que es connecten usuaris autenticats, o si permetem que es connecte tot el món.</p>
<p>Sempre ho podrem modificar, i això es fa des de la Consola de Firebase de la Base de Dades, en la pestanya <strong>Rules</strong>. En el mòdul d'Accés a Dades permetrem l'accés a tot el món posant les dues propietats a true. Sabreu que ho heu posat de forma correcta quan els dos <em>trues</em> us apareguen en roig</p>
<p style="text-align: center;"><img src="T7_2_2_3_1_5.png" alt="" width="1112" height="722" /></p>
<p class="titolet">Copiar les sentències per a escriure i per a llegir (millor dit per a detectar els canvis en temps real)</p>
<p>Ens diu un exemple de les sentències a copiar per a poder guardar una informació a la Base de Dades i també per a detectar un canvi en la Base de Dades i poder obtenir el nou valor. Encara que tinguem un projecte en Kotlin, les sentències d'exemple seran de Java, però que en copiar-les les traduiria a Kotlin. No fem diferenciació per tant entre Java i Kotlin en aquest moment.</p>
<p style="text-align: center;"><img src="T7_2_2_3_1_6.png" alt="" width="1270" height="820" /></p>
<p></p>
<p style="text-align: center;"></p>
</div>
</div>
</div>
<div class="iDevice_wrapper textIdevice" id="id179">
<div class="iDevice emphasis0" >
<div id="ta179_185_2" class="block iDevice_content">
<div class="exe-text"><p class="titolet">Exemple</p>
<p>A partir de l'anterior, anem a modificar-lo lleugerament, col·locant un <strong>EditText</strong> on es puga escriure i enviar una informació a la Base de Dades, o quan es modifica en la Base de Dades poder reflectir-lo.</p>
<p>Primer, a banda de connectar, haurem de "registrar" el que volem tant modificar com detectar que s'ha modificat. En aquest cas només serà una parella clau-valor, que anomenarem <strong>refA1</strong>, que es referirà a la parella clau-valor <strong>a1</strong></p>
<ul>
<li>Per a enviar utilitzem un botó, i senzillament quan s'aprete s'envia la informació: mofdifiquem el valor de <strong>refA1</strong></li>
<li>Per a rebre la informació hem "d'escoltar" si hi ha canvis, muntant un <strong>addValueEventListener</strong> sobre <strong>refA1</strong></li>
</ul>
<p>Aquest seria el <strong>ActivityMain.xml</strong><span style="font-style: italic;"><!--?</span--><span style="color: #0000ff; font-weight: bold;"></span></span></p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono'; font-size: 9,0pt;"><span style="font-style: italic;"><!--?</span--><span style="color: #0000ff; font-weight: bold;"></span></span></pre>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono'; font-size: 9,0pt;"><span style="font-style: italic;">&lt;?</span><span style="color: #0000ff; font-weight: bold;">xml version</span><span style="color: #008000; font-weight: bold;">="1.0" </span><span style="color: #0000ff; font-weight: bold;">encoding</span><span style="color: #008000; font-weight: bold;">="utf-8"</span><span style="font-style: italic;">?&gt;<br /></span>&lt;<span style="color: #000080; font-weight: bold;">androidx.constraintlayout.widget.ConstraintLayout </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/apk/res/android"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/apk/res-auto"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #0000ff; font-weight: bold;">xmlns:</span><span style="color: #660e7a; font-weight: bold;">tools</span><span style="color: #008000; font-weight: bold;">="http://schemas.android.com/tools"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="match_parent"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="match_parent"<br /></span><span style="color: #008000; font-weight: bold;">    </span><span style="color: #660e7a; font-weight: bold;">tools</span><span style="color: #0000ff; font-weight: bold;">:context</span><span style="color: #008000; font-weight: bold;">=".MainActivity"</span>&gt;<br /><br />    &lt;<span style="color: #000080; font-weight: bold;">EditText<br /></span><span style="color: #000080; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:id</span><span style="color: #008000; font-weight: bold;">="@+id/text"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="match_parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="wrap_content"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_alignParentTop</span><span style="color: #008000; font-weight: bold;">="true"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_centerHorizontal</span><span style="color: #008000; font-weight: bold;">="true"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintEnd_toEndOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintStart_toStartOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintTop_toTopOf</span><span style="color: #008000; font-weight: bold;">="parent" </span>/&gt;<br /><br />    &lt;<span style="color: #000080; font-weight: bold;">Button<br /></span><span style="color: #000080; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:id</span><span style="color: #008000; font-weight: bold;">="@+id/boto"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_width</span><span style="color: #008000; font-weight: bold;">="wrap_content"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_height</span><span style="color: #008000; font-weight: bold;">="wrap_content"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_below</span><span style="color: #008000; font-weight: bold;">="@+id/text"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_centerHorizontal</span><span style="color: #008000; font-weight: bold;">="true"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:layout_marginTop</span><span style="color: #008000; font-weight: bold;">="53dp"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">android</span><span style="color: #0000ff; font-weight: bold;">:text</span><span style="color: #008000; font-weight: bold;">="Enviar"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintEnd_toEndOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintStart_toStartOf</span><span style="color: #008000; font-weight: bold;">="parent"<br /></span><span style="color: #008000; font-weight: bold;">        </span><span style="color: #660e7a; font-weight: bold;">app</span><span style="color: #0000ff; font-weight: bold;">:layout_constraintTop_toTopOf</span><span style="color: #008000; font-weight: bold;">="@+id/text" </span>/&gt;<br /><br />&lt;/<span style="color: #000080; font-weight: bold;">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</pre>
<p></p>
<h2>JAVA</h2>
<p>I aquest seria el programa principal en Java:</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono'; font-size: 15,0pt;"><span style="color: #000080; font-weight: bold;">import </span>android.support.v7.app.AppCompatActivity;<br /><span style="color: #000080; font-weight: bold;">import </span>android.os.Bundle;<br /><span style="color: #000080; font-weight: bold;">import </span>android.util.Log;<br /><span style="color: #000080; font-weight: bold;">import </span>android.view.View;<br /><span style="color: #000080; font-weight: bold;">import </span>android.widget.Button;<br /><span style="color: #000080; font-weight: bold;">import </span>android.widget.EditText;<br /><br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.DataSnapshot;<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.DatabaseError;<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.DatabaseReference;<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.FirebaseDatabase;<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.ValueEventListener;<br /><br /><span style="color: #000080; font-weight: bold;">public class </span>MainActivity <span style="color: #000080; font-weight: bold;">extends </span>AppCompatActivity {<br /><br />    <span style="color: #808000;">@Override<br /></span><span style="color: #808000;">    </span><span style="color: #000080; font-weight: bold;">protected void </span>onCreate(Bundle savedInstanceState) {<br />        <span style="color: #000080; font-weight: bold;">super</span>.onCreate(savedInstanceState);<br />        setContentView(R.layout.<span style="color: #660e7a; font-weight: bold; font-style: italic;">activity_main</span>);<br />        <span style="color: #000080; font-weight: bold;">final </span>EditText editText = (EditText)findViewById(R.id.<span style="color: #660e7a; font-weight: bold; font-style: italic;">text</span>);<br /><br />        FirebaseDatabase database = FirebaseDatabase.<span style="font-style: italic;">getInstance</span>();<br />        <span style="color: #000080; font-weight: bold;">final </span>DatabaseReference refA1 = database.getReference(<span style="color: #008000; font-weight: bold;">"Missatge"</span>);<br /><br />        <span style="color: #000080; font-weight: bold;">final </span>Button boto = (Button)findViewById(R.id.<span style="color: #660e7a; font-weight: bold; font-style: italic;">boto</span>);<br />        boto.setText(<span style="color: #008000; font-weight: bold;">"Enviar"</span>);<br />        boto.setOnClickListener(<span style="color: #000080; font-weight: bold;">new </span>View.OnClickListener() {<br />            <span style="color: #808000;">@Override<br /></span><span style="color: #808000;">            </span><span style="color: #000080; font-weight: bold;">public void </span>onClick(View view) {<br />                <span style="color: #660e7a;">refA1</span>.setValue(<span style="color: #660e7a;">editText</span>.getText().toString());<br />                <span style="color: #660e7a;">editText</span>.setText(<span style="color: #008000; font-weight: bold;">""</span>);<br />            }<br />        });<br /><br />        refA1.addValueEventListener(<span style="color: #000080; font-weight: bold;">new </span>ValueEventListener() {<br />            <span style="color: #808000;">@Override<br /></span><span style="color: #808000;">            </span><span style="color: #000080; font-weight: bold;">public void </span>onDataChange(DataSnapshot dataSnapshot) {<br />                <span style="color: #808080; font-style: italic;">// This method is called once with the initial value and again<br /></span><span style="color: #808080; font-style: italic;">                // whenever data at this location is updated.<br /></span><span style="color: #808080; font-style: italic;">                </span>String value = dataSnapshot.getValue(String.<span style="color: #000080; font-weight: bold;">class</span>);<br />                <span style="color: #808080; font-style: italic;">//Log.d(TAG, "Value is: " + value);<br /></span><span style="color: #808080; font-style: italic;">                </span><span style="color: #660e7a;">editText</span>.setText(value);<br />            }<br /><br />            <span style="color: #808000;">@Override<br /></span><span style="color: #808000;">            </span><span style="color: #000080; font-weight: bold;">public void </span>onCancelled(DatabaseError error) {<br />                <span style="color: #808080; font-style: italic;">// Failed to read value<br /></span><span style="color: #808080; font-style: italic;">                //Log.w(TAG, "Failed to read value.", error.toException());<br /></span><span style="color: #808080; font-style: italic;">            </span>}<br />        });<br />    }<br />}</pre>
<p></p>
<h2>KOTLIN</h2>
<p>I aquest és el programa principal per al projecte en Kotlin.</p>
<pre style="background-color: #ffffff; color: #000000; font-family: 'DejaVu Sans Mono'; font-size: 9,0pt;"><span style="color: #000080; font-weight: bold;">import </span>androidx.appcompat.app.AppCompatActivity<br /><span style="color: #000080; font-weight: bold;">import </span>android.os.Bundle<br /><span style="color: #000080; font-weight: bold;">import </span>kotlinx.android.synthetic.main.activity_main.*<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.FirebaseDatabase<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.DatabaseError<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.DataSnapshot<br /><span style="color: #000080; font-weight: bold;">import </span>com.google.firebase.database.ValueEventListener<br /><br /><span style="color: #000080; font-weight: bold;">class </span>MainActivity : AppCompatActivity() {<br /><br />    <span style="color: #000080; font-weight: bold;">override fun </span>onCreate(savedInstanceState: Bundle?) {<br />        <span style="color: #000080; font-weight: bold;">super</span>.onCreate(savedInstanceState)<br />        setContentView(R.layout.<span style="color: #660e7a; font-style: italic;">activity_main</span>)<br /><br />        <span style="color: #000080; font-weight: bold;">val </span>refA1 = FirebaseDatabase.getInstance().getReference(<span style="color: #008000; font-weight: bold;">"Missatge"</span>)<br /><br />        boto.<span style="color: #660e7a; font-style: italic;">text </span>= <span style="color: #008000; font-weight: bold;">"Enviar"<br /></span><span style="color: #008000; font-weight: bold;">        </span>boto.setOnClickListener <span style="font-weight: bold;">{<br /></span><span style="font-weight: bold;">            </span>refA1.setValue(text.<span style="color: #660e7a; font-style: italic;">text</span>.toString())<br />            text.setText(<span style="color: #008000; font-weight: bold;">""</span>)<br />        <span style="font-weight: bold;">}<br /></span><span style="font-weight: bold;"><br /></span><span style="font-weight: bold;">        </span>refA1.addValueEventListener(<span style="color: #000080; font-weight: bold;">object </span>: ValueEventListener {<br />            <span style="color: #000080; font-weight: bold;">override fun </span>onDataChange(dataSnapshot: DataSnapshot) {<br />                <span style="color: #808080; font-style: italic;">// This method is called once with the initial value and again<br /></span><span style="color: #808080; font-style: italic;">                // whenever data at this location is updated.<br /></span><span style="color: #808080; font-style: italic;">                </span><span style="color: #000080; font-weight: bold;">val </span>value = dataSnapshot.getValue(String::<span style="color: #000080; font-weight: bold;">class</span>.<span style="color: #660e7a; font-style: italic;">java</span>)<br />                text.setText(value)<br />            }<br /><br />            <span style="color: #000080; font-weight: bold;">override fun </span>onCancelled(error: DatabaseError) {<br />                <span style="color: #808080; font-style: italic;">// Failed to read value<br /></span><span style="color: #808080; font-style: italic;">                //Log.w(TAG, "Failed to read value.", error.toException())<br /></span><span style="color: #808080; font-style: italic;">            </span>}<br />        })<br /><br />    }<br />    <br />}</pre>
<p>En el següent vídeo es veu tot el procés des del principi per al projecte Kotlin, encara que la clau valor utilitzada es diu <strong>message</strong> en compte de <strong>a1</strong>, i la referència <strong>myRef</strong> en compte de <strong>refA1</strong>:</p>
<p style="text-align: center;"><object width="1024" height="785" type="application/x-shockwave-flash" data="T7_Accedir_Firebase_bo_ret.swf" data-mce-fragment="1"><param name="src" value="T7_Accedir_Firebase_bo_ret.swf" /></object></p></div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="223_rd_utilitzaci_des_dandroid.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="2232_rdandroid_accs_a_les_dades.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
</div>
</div>
</div>
</body></html>