<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ca" xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>3.4.3 Consultes | Accés a Dades </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="ca" />
<meta name="author" content="Àlvar Serrano Calduch" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/2.5/" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
</head>
<body class="exe-web-site" id="exe-node-29"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Omet navegació</a></p>
<div id="header" ><div id="headerContent">Accés a Dades</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Tema 6: Bases de Dades Objecte-Relacionals i Orientades a Objectes</a></li>
   <li><a href="1_introducci.html" class="no-ch">1. Introducció</a></li>
   <li><a href="2__bases_de_dades_objecterelacionals.html" class="daddy">2 - Bases de Dades Objecte-Relacionals</a>
   <ul class="other-section">
      <li><a href="21__caracterstiques.html" class="no-ch">2.1 - Característiques</a></li>
      <li><a href="22__tipus_de_dades.html" class="no-ch">2.2 - Tipus de dades</a></li>
      <li><a href="23__manipulaci_de_dades.html" class="daddy">2.3 - Manipulació de dades</a>
      <ul class="other-section">
         <li><a href="231__sentncies_sql_per_a_tipus_de__dades_nous.html" class="no-ch">2.3.1 - Sentències SQL per a tipus de  dades nous</a></li>
         <li><a href="232__accs_a_travs_de_jdbc.html" class="daddy">2.3.2 - Accés a través de JDBC</a>
         <ul class="other-section">
            <li><a href="2321_boolean.html" class="no-ch">2.3.2.1 Boolean</a></li>
            <li><a href="2322_blob_i_clob.html" class="no-ch">2.3.2.2 BLOB i CLOB</a></li>
            <li><a href="2323_arrays.html" class="no-ch">2.3.2.3 Arrays</a></li>
            <li><a href="2324_estructurat.html" class="no-ch">2.3.2.4 Estructurat</a></li>
            <li><a href="2325_exemple_de_tot_junt.html" class="no-ch">2.3.2.5 Exemple de tot junt</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="24__altres_aportacions.html" class="daddy">2.4 - Altres aportacions</a>
      <ul class="other-section">
         <li><a href="241__polimorfisme_i_sobrecrrega_doperadors.html" class="no-ch">2.4.1 - Polimorfisme i sobrecàrrega d'operadors</a></li>
         <li><a href="242__herncia.html" class="no-ch">2.4.2 - Herència</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="3__bases_de_dades_orientades_a_objectes.html" class="current-page-parent daddy">3 - Bases de Dades Orientades a Objectes</a>
   <ul>
      <li><a href="31__installaci_de_db4o.html" class="no-ch">3.1 - Instal·lació de DB4O</a></li>
      <li><a href="32__funcionalitat_bsica.html" class="no-ch">3.2 - Funcionalitat bàsica</a></li>
      <li><a href="33__consultes.html" class="no-ch">3.3 - Consultes</a></li>
      <li class="current-page-parent"><a href="34_objectdb_voluntari.html" class="current-page-parent daddy">3.4 ObjectDB (voluntari)</a>
      <ul>
         <li><a href="341_installaci_d_objectdb.html" class="no-ch">3.4.1 Instal·lació d' ObjectDB</a></li>
         <li><a href="342_funcionalitat_bsica.html" class="no-ch">3.4.2 Funcionalitat bàsica</a></li>
         <li id="active"><a href="343_consultes.html" class="active no-ch">3.4.3 Consultes</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="exercicis.html" class="no-ch">Exercicis</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="342_funcionalitat_bsica.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">3.4.3 Consultes</h1></div>
<div class="iDevice_wrapper textIdevice" id="id45">
<div class="iDevice emphasis0" >
<div id="ta45_116_2" class="block iDevice_content">
<div class="exe-text"><p>Ja havíem comentat que <strong>ObjectDB</strong>, per basar-se en <strong>JPA</strong>, podrà utilitzar el llenguatge de consulta <strong>JPQL</strong> (<strong>Java Persistence Query Language</strong>), basat en SQL. Per tant tindrem molta més comoditat i potència per a fer les consultes, encara que no arribarà a la potència de SQL</p>
<div class="nota_blau">
<p><b><u>Nota</u></b></p>
<p>Si havíeu fet tots els exemples anteriors, potser siga millor esborrar <strong>Empleat.odb</strong> i tornar a executar <strong>Exemple1_InserirEmpleat.kt</strong> i <strong>Exemple1_1_InserirMesEmpleats.kt</strong> per a crear-les de nou.<br /> </p>
</div>
<p>Com ja vam veure en Hibernate, utilitzarem el mètode <strong>query()</strong> per a fer una consulta, però el llenguatge és lleugerament diferent. En aquella ocasió utilitzàvem <strong>HQL</strong> i ara <strong>JPQL</strong>.</p>
<p>La sentència sempre haurà de contenir la clàusula <strong>SELECT</strong>. La manera de tornar els objectes serà d'aquesta manera.</p>
<p><strong>SELECT e FROM Empleat e</strong></p>
<p>Per a executar la consulta utilitzarem ara el mètode <strong>resultList()</strong> de l'objecte <strong>Query</strong>, que ens tornarà una llista. Però com no hem especificat el tipus que estem buscant (excepte en el propi text de la consulta), el tipus base serà <strong>Any</strong>, la qual cosa ens obliga a fer un <strong>cast</strong>.</p>
<p>Copieu el següent codi al fitxer <strong>Exemple11_Consulta1.kt</strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>import classesEmpleat.Empleat
import javax.persistence.Persistence

fun main(){
    val bd = Persistence.createEntityManagerFactory("Empleat.odb").createEntityManager()

    val q = bd.createQuery("SELECT e FROM Empleat e")
    for (e in q.resultList) {
        e as Empleat
        println("Nif: " + e.nif + ". Nom: " + e.nom + ". Departament: " + e.departament + ". Població: " + e.adreca?.poblacio
        )
    }

    bd .close()
}</code></pre>
</div>
</div>
<p>El mètode <strong>createQuery()</strong> admet un segon paràmetre per a especificar la classe que tornarà la consulta, cosa que fa més senzilla la utilització.</p>
<p>Copieu el següent codi al fitxer <strong>Exemple12_Consulta2.kt</strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>import classesEmpleat.Empleat
import javax.persistence.Persistence

fun main(){
    val bd = Persistence.createEntityManagerFactory("Empleat.odb").createEntityManager()

    val q = bd.createQuery("SELECT e FROM Empleat e", Empleat::class.java)
    for (e in q.resultList) 
        println("Nif: " + e.nif + ". Nom: " + e.nom + ". Departament: " + e.departament + ". Població: " + e.adreca?.poblacio)

    bd .close()
}</code></pre>
</div>
</div>
<p>La consulta <strong>JPQL </strong>admetrà <strong>SELECT, WHERE, GROUP BY, HAVING, ORDER BY...</strong></p>
<p>I per a poder provar-les podem utilitzar el <strong>explorer.sh</strong>, en la pestanya <strong>Querys</strong>, baix a l'esquerra</p>
<p>En la imatge s'han triat els empleats del departament 10 i que viuean a Castelló (la població de l'adreça és Castelló). Sense problemes, amb la sintaxi lògica:</p>
<p><img src="T6_3_4_3_1.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" width="1407" height="730" /></p>
<p>I el programa que executaria aquesta consulta seria el següent. Copieu el següent codi al fitxer <strong>Exemple13_Consulta3.kt</strong></p>
<div class="highlighted-code language-java">
<div>
<pre><code>import classesEmpleat.Empleat
import javax.persistence.Persistence

fun main(){
    val bd = Persistence.createEntityManagerFactory("Empleat.odb").createEntityManager()

    val q = bd.createQuery("SELECT e " +
                                "FROM Empleat e " +
                                "WHERE departament=10 AND adreca.poblacio='Castelló'"
                           , Empleat::class.java)
    for (e in q.resultList)
        println("Nif: " + e.nif + ". Nom: " + e.nom + ". Departament: " + e.departament + ". Població: " + e.adreca?.poblacio)

    bd .close()
}</code></pre>
</div>
</div></div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="342_funcionalitat_bsica.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="exercicis.html" class="next"><span>Següent<span> &raquo;</span></span></a>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Llicenciat sota la </span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial CompartirIgual 2.5</a></p>
</div>
</div>
</div>
</div>
</body></html>